<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´¥é—¨è€å­—å· 3D äº¤äº’ç½‘é¡µç³»ç»Ÿ - 1928</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥å¤å¤å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --retro-gold: #d4af37;
            --retro-red: #8a1c1c;
            --retro-dark: #1a1a1a;
        }

        html, body { 
            margin: 0; 
            overflow: hidden; 
            height: 100%; 
            width: 100%; 
            background-color: #0f1115;
            color: #e5e5e5;
        }
        
        /* å­—ä½“ */
        .font-title { font-family: 'Ma Shan Zheng', cursive; }
        .font-body { font-family: 'Noto Serif SC', serif; }

        /* ç•Œé¢æš—è§’ä¸å™ªç‚¹æ•ˆæœ - è¥é€ èƒ¶ç‰‡æ„Ÿ */
        .vignette {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, transparent 50%, rgba(0,0,0,0.8) 100%);
            pointer-events: none;
            z-index: 5;
        }
        .noise {
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 4;
            opacity: 0.4;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            width: 60px; height: 60px;
            border: 4px solid var(--retro-gold);
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #2c2c2c; }
        ::-webkit-scrollbar-thumb { background: var(--retro-gold); border-radius: 3px; }

        /* æ¨¡æ€æ¡†è¿›å…¥åŠ¨ç”» */
        #modal-content {
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .modal-open #modal-content {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>

    <!-- 3D å®¹å™¨ -->
    <div id="canvas-container" class="absolute inset-0 z-0"></div>

    <!-- è§†è§‰æ»¤é•œå±‚ -->
    <div class="vignette"></div>
    <div class="noise"></div>

    <!-- UI å±‚ -->
    <div id="ui-layer" class="absolute inset-0 pointer-events-none z-20 flex flex-col justify-between p-6">
        
        <!-- å·¦ä¸Šè§’æ ‡é¢˜ -->
        <div class="pointer-events-auto transition-transform hover:translate-x-1 duration-300">
            <div class="flex items-center space-x-3">
                <div class="w-1 h-12 bg-yellow-600 shadow-[0_0_10px_#d4af37]"></div>
                <div>
                    <h1 class="text-4xl font-title text-yellow-500 tracking-widest drop-shadow-lg">åŠä¸šåœº</h1>
                    <p class="text-xs text-gray-400 font-body tracking-[0.2em] uppercase">Tianjin Grand Bazaar Â· 1928</p>
                </div>
            </div>
        </div>

        <!-- å³ä¸‹è§’æ“ä½œæç¤º -->
        <div class="self-end text-right pointer-events-auto">
            <div class="bg-black/40 backdrop-blur-sm border border-white/10 p-4 rounded-lg">
                <p class="text-xs text-yellow-500/80 font-body mb-2 border-b border-white/10 pb-1">äº¤äº’æŒ‡å—</p>
                <div class="text-xs text-gray-300 space-y-1 font-sans">
                    <p>ğŸ–±ï¸ å·¦é”®ç‚¹å‡» <span class="text-yellow-400">éœ“è™¹æ‹›ç‰Œ</span></p>
                    <p>ğŸ–ï¸ æ‹–æ‹½æ—‹è½¬è§†è§’</p>
                    <p>ğŸ” æ»šè½®ç¼©æ”¾åœºæ™¯</p>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½å±å¹• -->
    <div id="loading-screen" class="absolute inset-0 bg-[#0f1115] z-50 flex flex-col items-center justify-center transition-opacity duration-1000 pointer-events-auto">
        <div class="loading-spinner mb-6"></div>
        <h2 class="text-2xl font-title text-yellow-600 tracking-widest">æ´¥é—¨å¤œè‰²</h2>
        <p class="text-gray-500 text-xs mt-2 font-mono uppercase tracking-wide">Initializing 3D Environment...</p>
    </div>

    <!-- è°ƒè¯•æ—¥å¿— (éšè—) -->
    <div id="debug-console" class="hidden fixed bottom-0 left-0 w-full max-h-32 bg-black/80 text-green-400 font-mono text-xs p-2 overflow-y-auto z-50 pointer-events-none"></div>

    <!-- æ¨¡æ€æ¡†ï¼šç‹—ä¸ç† -->
    <div id="modal-goubuli" class="hidden fixed inset-0 z-40 flex items-center justify-center bg-black/80 backdrop-blur-sm transition-opacity duration-300 pointer-events-auto">
        <!-- çº¸è´¨é£æ ¼å¡ç‰‡ -->
        <div id="modal-content" class="relative w-full max-w-2xl bg-[#e8e0d0] text-[#2c2c2c] rounded-sm shadow-[0_0_50px_rgba(0,0,0,0.8)] overflow-hidden flex flex-col md:flex-row border-8 border-double border-[#5c4033]">
            
            <!-- å…³é—­æŒ‰é’® -->
            <button id="btn-close" class="absolute top-2 right-2 z-10 w-8 h-8 flex items-center justify-center bg-[#8a1c1c] text-white rounded-full hover:bg-red-700 transition shadow-md">
                âœ•
            </button>

            <!-- å·¦ä¾§ï¼šå›¾ç‰‡ä¸å°ç«  -->
            <div class="md:w-5/12 bg-[#2c2c2c] relative overflow-hidden">
                <img src="https://placehold.co/400x600/2c2c2c/d4af37?text=Goubuli" class="w-full h-full object-cover opacity-80" alt="åŒ…å­">
                <div class="absolute bottom-4 left-4 border-2 border-[#d4af37] p-2 text-[#d4af37]">
                    <p class="font-title text-2xl writing-vertical-rl">éé—ç¾é£Ÿ</p>
                </div>
                <!-- è£…é¥°æ€§å°ç«  -->
                <div class="absolute top-4 right-4 w-12 h-12 border-2 border-red-800 rounded-sm flex items-center justify-center rotate-12 opacity-80">
                    <span class="text-red-800 font-title text-xs">è€å­—å·</span>
                </div>
            </div>

            <!-- å³ä¾§ï¼šå†…å®¹ -->
            <div class="md:w-7/12 p-8 flex flex-col justify-between bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')]">
                <div>
                    <h2 class="text-4xl font-title text-[#8a1c1c] mb-2">ç‹—ä¸ç†åŒ…å­</h2>
                    <p class="text-xs text-gray-600 font-serif italic mb-6">Go Believe Steamed Buns Â· Since 1858</p>
                    
                    <div class="space-y-4 font-body text-sm leading-relaxed text-gray-800">
                        <p>
                            <span class="font-bold text-[#8a1c1c]">ã€å·¥è‰ºã€‘</span> 
                            é‡‡ç”¨â€œåŠå‘é¢ï¼Œæ°´æ‰“é¦…â€æŠ€è‰ºã€‚é¢çš®æŸ”è½¯è€Œæœ‰åš¼åŠ²ï¼Œé¦…æ–™æ±¤æ±ä¸°ç›ˆã€‚
                        </p>
                        <p>
                            <span class="font-bold text-[#8a1c1c]">ã€ç‰¹è‰²ã€‘</span> 
                            æ¯ä¸ªåŒ…å­ä¸å°‘äºåå…«ä¸ªè¤¶ï¼Œè¤¶èŠ±åŒ€ç§°ï¼Œå½¢ä¼¼ç™½èŠã€‚
                        </p>
                    </div>
                </div>

                <div class="mt-8 border-t-2 border-[#5c4033] pt-4 flex items-center justify-between">
                    <div>
                        <p class="text-xs text-gray-500">ä»Šæ—¥æŒ‚ç‰Œä»·</p>
                        <p class="text-3xl font-bold text-[#8a1c1c] font-body">Â¥ 38.00 <span class="text-sm font-normal">/ ç¬¼</span></p>
                    </div>
                    <button class="bg-[#8a1c1c] text-[#e8e0d0] px-6 py-2 font-title text-lg hover:bg-[#a62828] transition shadow-lg border-2 border-[#5c4033]">
                        åŠ å…¥é£Ÿå•
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS é€»è¾‘ -->
    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js';

        // è°ƒè¯•å·¥å…·
        const debugConsole = document.getElementById('debug-console');
        function log(msg, isError = false) {
            console.log(msg);
            if (isError) {
                debugConsole.innerHTML += `<div class="text-red-500">> ${msg}</div>`;
                debugConsole.classList.remove('hidden');
            }
        }
        window.onerror = (e) => log(e, true);

        // æ ¸å¿ƒå˜é‡
        let scene, camera, renderer, controls;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let clock = new THREE.Clock();
        
        // äº¤äº’å¯¹è±¡åˆ—è¡¨
        let interactables = [];
        let hoverObject = null; // å½“å‰é¼ æ ‡æ‚¬åœçš„å¯¹è±¡

        // åŠ¨ç”»å¯¹è±¡
        let mahuaGroup;
        let isMahuaAnimating = false;

        init();
        animate();

        function init() {
            try {
                const container = document.getElementById('canvas-container');

                // 1. åœºæ™¯
                scene = new THREE.Scene();
                // ä½¿ç”¨é›¾æ°”è¥é€ æ·±å¤œçš„æ™¯æ·±æ„Ÿ
                scene.fog = new THREE.FogExp2(0x0f1115, 0.025);

                // 2. ç›¸æœº
                camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 200);
                camera.position.set(12, 6, 16); // ä¾§æ–¹è§†è§’ï¼Œçªå‡ºè½¬è§’

                // 3. æ¸²æŸ“å™¨
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                // ç‰©ç†å…‰ç…§è®¾ç½®
                renderer.physicallyCorrectLights = true;
                renderer.toneMapping = THREE.ReinhardToneMapping;
                renderer.toneMappingExposure = 2.5;
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                container.appendChild(renderer.domElement);

                // 4. ç¯å…‰
                setupLighting();

                // 5. å»ºç­‘ç¯å¢ƒ
                createCornerBuilding();
                createStreetElements();

                // 6. æ§åˆ¶å™¨
                controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 8;
                controls.maxDistance = 30;
                controls.maxPolarAngle = Math.PI / 2 - 0.05; // ç¦æ­¢ç©¿åœ°
                controls.target.set(0, 4, 0);

                // 7. äº‹ä»¶
                window.addEventListener('resize', onWindowResize);
                window.addEventListener('pointermove', onPointerMove);
                window.addEventListener('click', onClick);

                // éšè—åŠ è½½
                setTimeout(() => {
                    document.getElementById('loading-screen').style.opacity = '0';
                    setTimeout(() => document.getElementById('loading-screen').remove(), 1000);
                }, 1000);

            } catch (err) {
                log(`Init Error: ${err.message}`, true);
            }
        }

        function setupLighting() {
            // æœˆå…‰ï¼ˆå†·è‰²ï¼ŒèƒŒå…‰ï¼‰
            const moonLight = new THREE.DirectionalLight(0x4a6fa5, 1);
            moonLight.position.set(-10, 20, -10);
            moonLight.castShadow = true;
            scene.add(moonLight);

            // è¡—é“ç¯å¢ƒå…‰
            const ambient = new THREE.AmbientLight(0x222222, 0.5);
            scene.add(ambient);

            // é‡ç‚¹æš–å…‰æºï¼ˆæ¨¡æ‹Ÿè·¯ç¯/æ©±çª—å…‰ï¼‰
            const warmLight = new THREE.PointLight(0xffaa55, 10, 20);
            warmLight.position.set(5, 5, 5);
            warmLight.castShadow = true;
            scene.add(warmLight);
            
            // è¡¥å…‰
            const fillLight = new THREE.PointLight(0x88ccff, 2, 15);
            fillLight.position.set(-5, 5, 5);
            scene.add(fillLight);
        }

        // åˆ›å»ºè½¬è§’å»ºç­‘ (Art Deco é£æ ¼)
        function createCornerBuilding() {
            const buildingGroup = new THREE.Group();

            // æè´¨
            const wallMat = new THREE.MeshStandardMaterial({ color: 0x8c8c8c, roughness: 0.7 }); // ç°è‰²çŸ³æ
            const trimMat = new THREE.MeshStandardMaterial({ color: 0xd4af37, roughness: 0.4, metalness: 0.6 }); // é‡‘è‰²è£…é¥°
            const winMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a, roughness: 0.1, metalness: 0.8 }); // æ·±è‰²çª—æˆ·
            
            // --- 1. è½¬è§’åœ†å¡” (Corner Tower) ---
            const towerGeo = new THREE.CylinderGeometry(2, 2, 12, 16, 1, true, 0, Math.PI/2);
            // æ—‹è½¬ä½¿å…¶æœå‘å¤–ä¾§
            const tower = new THREE.Mesh(towerGeo, wallMat);
            tower.position.set(0, 6, 0);
            tower.rotation.y = Math.PI / 4; // 45åº¦è§’
            buildingGroup.add(tower);

            // å¡”é¡¶ç©¹é¡¶
            const domeGeo = new THREE.SphereGeometry(2, 16, 16, 0, Math.PI * 2, 0, Math.PI/2);
            const dome = new THREE.Mesh(domeGeo, new THREE.MeshStandardMaterial({ color: 0x2d3436, roughness: 0.5 }));
            dome.position.set(0, 12, 0);
            buildingGroup.add(dome);
            
            // å¡”å°–
            const spire = new THREE.Mesh(new THREE.ConeGeometry(0.2, 3, 8), trimMat);
            spire.position.set(0, 14, 0);
            buildingGroup.add(spire);

            // --- 2. ä¸¤ä¾§ç¿¼æ¥¼ (Wings) ---
            // å·¦ç¿¼
            const leftWing = createWing(8, 10, 0);
            leftWing.position.set(-4.5, 5, -1.2);
            leftWing.rotation.y = -Math.PI / 6; // ç¨å¾®å†…æ”¶
            buildingGroup.add(leftWing);

            // å³ç¿¼
            const rightWing = createWing(8, 10, 0);
            rightWing.position.set(4.5, 5, -1.2);
            rightWing.rotation.y = Math.PI / 6;
            buildingGroup.add(rightWing);

            // --- 3. è£…é¥°æŸ± (Columns) ---
            const colGeo = new THREE.CylinderGeometry(0.3, 0.3, 8, 16);
            const col1 = new THREE.Mesh(colGeo, trimMat); col1.position.set(-1.8, 4, 1.2);
            const col2 = new THREE.Mesh(colGeo, trimMat); col2.position.set(1.8, 4, 1.2);
            buildingGroup.add(col1, col2);

            scene.add(buildingGroup);

            // --- 4. æ‹›ç‰Œä¸äº¤äº’ç‰© ---
            createSignage(buildingGroup);
        }

        // è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºä¾§ç¿¼æ¥¼
        function createWing(width, height, depth) {
            const group = new THREE.Group();
            
            const wallGeo = new THREE.BoxGeometry(width, height, 2);
            const wall = new THREE.Mesh(wallGeo, new THREE.MeshStandardMaterial({ color: 0x7f8c8d }));
            group.add(wall);

            // çª—æˆ·é˜µåˆ—
            const winGeo = new THREE.PlaneGeometry(1, 1.5);
            const winMat = new THREE.MeshStandardMaterial({ color: 0x000, emissive: 0x332200, emissiveIntensity: 0.5 }); // å¾®å¾®å‘å…‰çš„çª—æˆ·
            
            for(let i=-2; i<=2; i++) {
                // ä¸€å±‚
                const w1 = new THREE.Mesh(winGeo, winMat);
                w1.position.set(i * 1.5, -2, 1.01);
                group.add(w1);
                // äºŒå±‚
                const w2 = new THREE.Mesh(winGeo, winMat);
                w2.position.set(i * 1.5, 2, 1.01);
                group.add(w2);
            }

            return group;
        }

        function createSignage(parent) {
            // 1. ç‹—ä¸ç† (ç«–å‘éœ“è™¹ç¯ç‰Œ)
            const signGroup = new THREE.Group();
            signGroup.position.set(-4, 5, 2.5);
            
            // ç‰Œä½“
            const board = new THREE.Mesh(
                new THREE.BoxGeometry(1.2, 4, 0.2),
                new THREE.MeshStandardMaterial({ color: 0x330000 })
            );
            signGroup.add(board);

            // å‘å…‰å­— (ç®€åŒ–ä¸ºå‘å…‰å—)
            const glowMat = new THREE.MeshStandardMaterial({ 
                color: 0xff3300, 
                emissive: 0xff0000, 
                emissiveIntensity: 2 
            });
            const textBlock = new THREE.Mesh(new THREE.BoxGeometry(0.8, 3.5, 0.05), glowMat);
            textBlock.position.z = 0.1;
            textBlock.name = "GOUBULI"; // äº¤äº’ID
            signGroup.add(textBlock);

            // æ‚¬æŒ‚æ¶
            const hanger = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 1, 8), new THREE.MeshStandardMaterial({color: 0x333}));
            hanger.rotation.z = Math.PI / 2;
            hanger.position.x = 1;
            signGroup.add(hanger);

            scene.add(signGroup);
            interactables.push(textBlock);

            // 2. æ¡‚å‘ç¥¥ (æ¨ªå¹…å¹Œå­)
            const bannerGroup = new THREE.Group();
            bannerGroup.position.set(4, 6, 2.5);

            // å¹Œå­é¢
            const clothGeo = new THREE.BoxGeometry(2.5, 4, 0.1);
            const clothMat = new THREE.MeshStandardMaterial({ color: 0xb8860b }); // æš—é‡‘è‰²
            const banner = new THREE.Mesh(clothGeo, clothMat);
            banner.name = "GUIFAXIAN";
            bannerGroup.add(banner);
            
            // è£…é¥°å­—åŒºåŸŸ
            const textZone = new THREE.Mesh(new THREE.PlaneGeometry(1.5, 3), new THREE.MeshStandardMaterial({color: 0x800000}));
            textZone.position.z = 0.06;
            textZone.name = "GUIFAXIAN"; // ä¹Ÿå¯ä»¥ç‚¹å‡»
            bannerGroup.add(textZone);

            scene.add(bannerGroup);
            interactables.push(banner);
            interactables.push(textZone);

            // 3. éº»èŠ±æ¨¡å‹ (éšè—)
            mahuaGroup = new THREE.Group();
            const twistGeo = new THREE.TorusKnotGeometry(0.6, 0.2, 100, 16);
            const pastryMat = new THREE.MeshStandardMaterial({ 
                color: 0xd4af37, 
                roughness: 0.4, 
                emissive: 0xaa6600,
                emissiveIntensity: 0.2
            });
            const twist = new THREE.Mesh(twistGeo, pastryMat);
            mahuaGroup.add(twist);
            
            // æ·»åŠ ä¸€äº›ç²’å­/ç¢å±‘
            const particleGeo = new THREE.BufferGeometry();
            const count = 50;
            const positions = new Float32Array(count * 3);
            for(let i=0; i<count*3; i++) positions[i] = (Math.random() - 0.5) * 3;
            particleGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const particles = new THREE.Points(particleGeo, new THREE.PointsMaterial({color: 0xffd700, size: 0.1}));
            mahuaGroup.add(particles);

            mahuaGroup.position.set(4, 3, 4);
            mahuaGroup.scale.set(0, 0, 0);
            scene.add(mahuaGroup);
        }

        function createStreetElements() {
            // åœ°é¢ - æ¹¿æ¶¦åå…‰è·¯é¢
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(100, 100),
                new THREE.MeshStandardMaterial({ 
                    color: 0x050505, 
                    roughness: 0.1, 
                    metalness: 0.3 
                })
            );
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // è·¯ç¯
            const lampGeo = new THREE.CylinderGeometry(0.1, 0.15, 6, 8);
            const lampMat = new THREE.MeshStandardMaterial({ color: 0x111 });
            
            const lamp1 = new THREE.Mesh(lampGeo, lampMat);
            lamp1.position.set(-8, 3, 8);
            scene.add(lamp1);

            // ç¯å¤´è¾‰å…‰
            const bulb = new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshBasicMaterial({color: 0xffaa00}));
            bulb.position.set(0, 3, 0);
            lamp1.add(bulb);
        }

        // äº¤äº’é€»è¾‘
        function onPointerMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactables, false);

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                if (hoverObject !== obj) {
                    document.body.style.cursor = 'pointer';
                    // ç®€å•çš„ç¼©æ”¾åé¦ˆ
                    if(hoverObject) hoverObject.scale.set(1, 1, 1); 
                    hoverObject = obj;
                    // æŸäº›å¯¹è±¡å¯èƒ½å·²ç»åœ¨çˆ¶çº§æœ‰ç¼©æ”¾ï¼Œè¿™é‡Œä¸ºäº†ç®€å•åªå¾®è°ƒ
                    // å®é™…é¡¹ç›®ä¸­åº”ä¿å­˜åŸå§‹scale
                }
            } else {
                if (hoverObject) {
                    document.body.style.cursor = 'default';
                    hoverObject = null;
                }
            }
        }

        function onClick() {
            if (hoverObject) {
                const name = hoverObject.name;
                if (name === "GOUBULI") {
                    openModal();
                } else if (name === "GUIFAXIAN") {
                    triggerMahuaEffect();
                }
            }
        }

        // æ¨¡æ€æ¡†é€»è¾‘
        const modal = document.getElementById('modal-goubuli');
        const closeBtn = document.getElementById('btn-close');

        function openModal() {
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('modal-open'), 10);
        }
        function closeModal() {
            modal.classList.remove('modal-open');
            setTimeout(() => modal.classList.add('hidden'), 500);
        }
        closeBtn.onclick = closeModal;
        modal.onclick = (e) => { if(e.target === modal) closeModal(); }

        // éº»èŠ±ç‰¹æ•ˆ
        function triggerMahuaEffect() {
            if (isMahuaAnimating) return;
            isMahuaAnimating = true;

            const start = performance.now();
            const duration = 3000;

            function loop(now) {
                const elapsed = now - start;
                const p = Math.min(elapsed / duration, 1);

                // å¼¹è·³æ”¾å¤§æ—‹è½¬
                const scale = Math.sin(p * Math.PI) * 2; // 0 -> 2 -> 0
                mahuaGroup.scale.setScalar(scale);
                mahuaGroup.rotation.y = p * Math.PI * 6; // æ—‹è½¬3åœˆ
                mahuaGroup.rotation.z = Math.sin(p * Math.PI * 2) * 0.5;

                if (p < 1) requestAnimationFrame(loop);
                else {
                    isMahuaAnimating = false;
                    mahuaGroup.scale.set(0, 0, 0);
                }
            }
            requestAnimationFrame(loop);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            // æ‹›ç‰Œæµ®åŠ¨åŠ¨ç”»
            scene.traverse(obj => {
                if (obj.name === 'GOUBULI') {
                    // éœ“è™¹ç¯é—ªçƒ
                    obj.material.emissiveIntensity = 1.5 + Math.sin(t * 10) * 0.5;
                }
            });

            controls.update();
            renderer.render(scene, camera);
        }

    </script>
</body>
</html>