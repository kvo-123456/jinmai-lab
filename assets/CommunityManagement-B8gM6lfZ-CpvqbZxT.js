import{C as m,c as e,az as P,aC as ee,aB as l}from"./index-DvRCDgMZ.js";const re=({isDark:r,userCommunities:p,onUserCommunitiesChange:f,joinedCommunities:k,onJoinedCommunitiesChange:S,adminStore:d,onAdminStoreChange:j,memberStore:g,onMemberStoreChange:y,announceStore:v,onAnnounceStoreChange:B,privacyStore:x,onPrivacyStoreChange:w,currentEmail:o,communityTab:z,onCommunityTabChange:R})=>{const[F,_]=m.useState(""),[D,J]=m.useState(""),[U,A]=m.useState(""),[u,N]=m.useState(null),[n,H]=m.useState(null),[L,b]=m.useState(""),[$,q]=m.useState(null),h=t=>{var i;return((i=d[t])==null?void 0:i.includes(o))||!1},G=()=>{const t=F.trim(),i=D.trim(),a=U.split(",").map(c=>c.trim()).filter(Boolean);if(!t){l.warning("请输入社群名称");return}if(!i){l.warning("请输入社群简介");return}const s=`uc-${Date.now()}`;f([{id:s,name:t,description:i,cover:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1920x1080&prompt=User%20community%20banner%20minimal%20style",tags:a,members:1},...p]),S([...k,s]),o&&(j({...d,[s]:[o]}),y({...g,[s]:[o]})),w({...x,[s]:"public"}),_(""),J(""),A(""),R("user"),l.success("已创建社群")},I=t=>{if(!window.confirm("确定要删除这个社群吗？此操作不可恢复。"))return;f(p.filter(C=>C.id!==t)),S(k.filter(C=>C!==t));const i={...d},a={...g},s={...v},c={...x};delete i[t],delete a[t],delete s[t],delete c[t],j(i),y(a),B(s),w(c),l.success("社群已删除")},Q=t=>{N({id:t.id,name:t.name,desc:t.description,tags:t.tags.join(",")})},T=()=>{N(null)},V=()=>{if(!u)return;const t=u.name.trim(),i=u.desc.trim(),a=u.tags.split(",").map(c=>c.trim()).filter(Boolean);if(!t||!i){l.warning("名称与简介不能为空");return}const s=p.map(c=>c.id===u.id?{...c,name:t,description:i,tags:a}:c);f(s),l.success("已保存社群信息"),N(null)},W=t=>{H(t),b("")},M=()=>{H(null),b("")},X=()=>{if(!n)return;if(!h(n)){l.warning("仅管理员可添加成员");return}const t=L.trim().toLowerCase();if(!t||!t.includes("@")){l.warning("请输入有效邮箱");return}const i={...g,[n]:Array.from(new Set([...g[n]||[],t]))};y(i),b(""),l.success("已添加成员")},Y=t=>{if(!n)return;if(!h(n)){l.warning("仅管理员可移除成员");return}const i={...g,[n]:(g[n]||[]).filter(a=>a!==t)};y(i),l.success("已移除成员")},Z=t=>{if(!n)return;if(!h(n)){l.warning("仅管理员可设置公告");return}const i={...v,[n]:t};B(i),l.success("公告已更新")},E=()=>{if(!n)return;if(!h(n)){l.warning("仅管理员可切换隐私");return}const t=x[n]||"public",i={...x,[n]:t==="public"?"private":"public"};w(i),l.success(`社群已切换为${t==="public"?"私密":"公开"}模式`)},K=t=>{if(!n)return;if(!h(n)){l.warning("仅管理员可更改角色");return}const i=d[n]||[],a=i.includes(t)?i.filter(c=>c!==t):[...i,t],s={...d,[n]:a};j(s),l.success("管理员角色已更新")},O=t=>{q($===t?null:t)};return e.jsxs(e.Fragment,{children:[z==="user"&&e.jsxs("div",{className:`${r?"bg-gray-700":"bg-white/70"} p-4 rounded-xl mb-4 ring-1 ${r?"ring-gray-700":"ring-rose-200"}`,children:[e.jsx("div",{className:"text-sm opacity-70 mb-2",children:"创建新社群"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("input",{value:F,onChange:t=>_(t.target.value),placeholder:"社群名称",className:`${r?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${r?"focus:ring-purple-500":"focus:ring-pink-300"}`}),e.jsx("input",{value:D,onChange:t=>J(t.target.value),placeholder:"社群简介",className:`${r?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${r?"focus:ring-purple-500":"focus:ring-pink-300"}`}),e.jsx("input",{value:U,onChange:t=>A(t.target.value),placeholder:"标签（逗号分隔）",className:`${r?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${r?"focus:ring-purple-500":"focus:ring-pink-300"}`})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:G,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-red-600 to-pink-600 text-white transition-colors hover:opacity-90",children:"创建"})})]}),z==="user"&&e.jsx(e.Fragment,{children:p.length===0?e.jsx("div",{className:`text-sm ${r?"text-gray-400":"text-gray-600"}`,children:"暂无自建社群，快来创建吧～"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(t=>{var i;return e.jsxs(P.div,{className:`${r?"bg-gray-800":"bg-white/80"} ring-1 ${r?"ring-gray-700":"ring-rose-200"} rounded-xl overflow-hidden shadow-sm`,whileHover:{y:-4},children:[e.jsx(ee,{src:t.cover,alt:t.name,className:"w-full aspect-[4/3] object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"font-medium mb-1 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${r?"bg-gray-700 text-gray-300":"bg-rose-100 text-rose-700"} ring-1 ${r?"ring-gray-700":"ring-rose-200"}`,children:"个人"})]}),e.jsx("div",{className:`text-sm mb-2 ${r?"text-gray-300":"text-gray-700"} line-clamp-2`,children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:t.tags.slice(0,3).map((a,s)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${r?"bg-gray-700 text-gray-200":"bg-gray-100 text-gray-700"}`,children:["#",a]},s))}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-1 cursor-pointer",onClick:()=>O(t.id),children:[e.jsxs("span",{children:["成员 ",((i=g[t.id])==null?void 0:i.length)||1," 人"]}),e.jsx("span",{children:$===t.id?"▼":"▶"})]}),$===t.id&&e.jsx("div",{className:"mt-2 space-y-1 text-xs max-h-[120px] overflow-y-auto",children:[o,...g[t.id]||[]].map((a,s)=>{var c;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:a}),e.jsx("span",{className:`px-1.5 py-0.5 rounded ${r?"bg-gray-700":"bg-gray-100"}`,children:(c=d[t.id])!=null&&c.includes(a)?"管理员":"成员"})]},s)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`text-xs ${r?"text-gray-400":"text-gray-600"}`,children:x[t.id]==="private"?"私密":"公开"}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:(u==null?void 0:u.id)===t.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:V,className:`text-xs px-2 py-0.5 rounded-full ${r?"bg-green-600 text-white":"bg-green-500 text-white"}`,children:"保存"}),e.jsx("button",{onClick:T,className:`text-xs px-2 py-0.5 rounded-full ${r?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"}`,children:"取消"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Q(t),className:`text-xs px-2 py-0.5 rounded-full ${r?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"}`,children:"编辑"}),e.jsx("button",{onClick:()=>W(t.id),className:`text-xs px-2 py-0.5 rounded-full ${r?"bg-blue-600 text-white":"bg-blue-500 text-white"}`,children:"管理"}),e.jsx("button",{onClick:()=>I(t.id),className:`text-xs px-2 py-0.5 rounded-full ${r?"bg-red-600 text-white":"bg-red-500 text-white"}`,children:"删除"})]})})]})]})]},t.id)})})}),n&&e.jsx("div",{className:`fixed inset-0 z-50 ${r?"bg-black/70":"bg-black/50"} backdrop-blur-sm flex items-center justify-center p-4`,children:e.jsxs(P.div,{className:`${r?"bg-gray-800":"bg-white"} rounded-2xl shadow-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"社群管理"}),e.jsx("button",{onClick:M,className:`${r?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"} text-xl`,children:"×"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"成员管理"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{value:L,onChange:t=>b(t.target.value),placeholder:"添加成员邮箱",className:`flex-1 ${r?"bg-gray-700 text-white ring-1 ring-gray-600":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${r?"focus:ring-purple-500":"focus:ring-pink-300"}`}),e.jsx("button",{onClick:X,className:`${r?"bg-blue-600 text-white":"bg-blue-500 text-white"} px-3 py-2 rounded-lg text-sm`,children:"添加"})]}),e.jsx("div",{className:"space-y-2",children:[o,...g[n]||[]].map((t,i)=>{var a,s;return e.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg ${r?"bg-gray-700":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm",children:t}),((a=d[n])==null?void 0:a.includes(t))&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${r?"bg-purple-600 text-white":"bg-purple-500 text-white"}`,children:"管理员"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t!==o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>K(t),className:`text-xs px-2 py-1 rounded-full ${r?"bg-gray-600 text-white":"bg-gray-200 text-gray-800"}`,children:(s=d[n])!=null&&s.includes(t)?"移除管理员":"设为管理员"}),e.jsx("button",{onClick:()=>Y(t),className:`text-xs px-2 py-1 rounded-full ${r?"bg-red-600 text-white":"bg-red-500 text-white"}`,children:"移除"})]})})]},i)})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"社群设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm",children:"隐私设置"}),e.jsx("button",{onClick:E,className:`text-xs px-3 py-1 rounded-full ${x[n]==="private"?r?"bg-gray-600 text-white":"bg-gray-200 text-gray-800":r?"bg-blue-600 text-white":"bg-blue-500 text-white"}`,children:x[n]==="private"?"私密":"公开"})]}),e.jsx("div",{className:`text-xs ${r?"text-gray-400":"text-gray-600"}`,children:x[n]==="private"?"仅邀请成员可加入":"所有人可加入"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm mb-2",children:"社群公告"}),e.jsx("textarea",{value:v[n]||"",onChange:t=>Z(t.target.value),placeholder:"输入社群公告",className:`w-full h-20 ${r?"bg-gray-700 text-white ring-1 ring-gray-600":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${r?"focus:ring-purple-500":"focus:ring-pink-300"}`})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:M,className:`px-4 py-2 rounded-lg ${r?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"} transition-colors hover:opacity-90`,children:"关闭"})})]})})]})};export{re as default};
