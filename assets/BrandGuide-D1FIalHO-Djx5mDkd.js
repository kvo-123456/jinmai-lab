import{aD as G,C as s,c as t,aS as V,az as j,aB as x}from"./index-DvRCDgMZ.js";import{n as v}from"./brands-DuRnfe6a-D7ZPrGsZ.js";import{h as M}from"./ipService-BJ5gZhtN-KQ_p4mQK.js";function Q(){const{isDark:r}=G(),[n,D]=s.useState(v[0]),[N,A]=s.useState(""),[w,L]=s.useState("想怎么创新麻花？"),[p,k]=s.useState(""),[h,$]=s.useState(""),[y,f]=s.useState(""),[z,I]=s.useState([]),[g,F]=s.useState("all"),[u,R]=s.useState("recent"),[T,U]=s.useState(0);s.useEffect(()=>{try{const e=localStorage.getItem("BrandGuide.persist");if(e){const a=JSON.parse(e),i=v.find(l=>l.id===a.brandId);i&&D(i),typeof a.brandSearch=="string"&&A(a.brandSearch),typeof a.chat=="string"&&L(a.chat),typeof a.contact=="string"&&k(a.contact),typeof a.phone=="string"&&$(a.phone),typeof a.idea=="string"&&f(a.idea),["all","pending","negotiating","approved","rejected"].includes(a.statusFilter)&&F(a.statusFilter),["recent","old","status"].includes(a.sortKey)&&R(a.sortKey)}}catch{}},[]),s.useEffect(()=>{try{const e={brandId:n.id,brandSearch:N,chat:w,contact:p,phone:h,idea:y,statusFilter:g,sortKey:u};localStorage.setItem("BrandGuide.persist",JSON.stringify(e))}catch{}},[n.id,N,w,p,h,y,g,u]);const b=s.useMemo(()=>M.getAllPartnerships().filter(e=>e.brandName===n.name),[n,T]),C=s.useMemo(()=>{const e={pending:0,negotiating:0,approved:0,rejected:0};return b.forEach(a=>{e[a.status]=(e[a.status]||0)+1}),e},[b]),S=s.useMemo(()=>{let e=b;g!=="all"&&(e=e.filter(o=>o.status===g));const a=(o,c)=>new Date(c.updatedAt).getTime()-new Date(o.updatedAt).getTime(),i=(o,c)=>new Date(o.updatedAt).getTime()-new Date(c.updatedAt).getTime(),l={pending:0,negotiating:1,approved:2,rejected:3},m=u==="recent"?a:u==="old"?i:(o,c)=>l[o.status]-l[c.status];return[...e].sort(m)},[b,g,u]),H=()=>{const e=S,a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.download=`${n.name}-合作申请.json`,l.click(),URL.revokeObjectURL(i)},J=()=>{const e=["品牌","说明","状态","奖励","更新时间"],a=S.map(c=>[c.brandName,c.description.replace(/\n/g," "),c.status,c.reward,new Date(c.updatedAt).toLocaleString()]),i=[e,...a].map(c=>c.map(P=>'"'+String(P).replace(/"/g,'""')+'"').join(",")).join(`
`),l=new Blob([i],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(l),o=document.createElement("a");o.href=m,o.download=`${n.name}-合作申请.csv`,o.click(),URL.revokeObjectURL(m)},d=s.useMemo(()=>{const e=p.trim().length>0,a=h.trim(),i=/^1[3-9]\d{9}$/.test(a),l=a.length>=5&&!/\s/.test(a),m=i||l,o=y.trim().length>0;return{nameOk:e,phoneOk:m,ideaOk:o,nameMsg:e?"":"请输入联系人姓名",phoneMsg:m?"":"请输入有效的联系方式（手机或微信）",ideaMsg:o?"":`请输入合作想法（基于 ${n.name} ）`}},[p,h,y,n.name]),O=d.nameOk&&d.phoneOk&&d.ideaOk,K=(e,a)=>{M.updatePartnershipStatus(e,a)?(U(i=>i+1),x.success("状态已更新")):x.error("更新失败")},B=async()=>{const e=w.trim()||`围绕${n.name}做一次联名升级`,a=[`${n.name} × 校园潮流：${e}，推出限定周边礼盒`,`${n.name} 城市记忆计划：${e}，设计主题海报与KV`,`${n.name} 数字文创：${e}，发布数字藏品或表情包`];I(a)},E=()=>{if(!p.trim()){x.warning("请输入联系人姓名");return}const e=h.trim(),a=/^1[3-9]\d{9}$/.test(e),i=e.length>=5&&!/\s/.test(e);if(!a&&!i){x.warning("请输入有效的联系方式（手机或微信）");return}if(!y.trim()){x.warning("请输入合作想法");return}M.createPartnership({brandName:n.name,brandLogo:n.image,description:`${y}（联系人：${p}，电话：${h}）`,reward:"待协商",status:"pending",ipAssetId:"ip-001"}),k(""),$(""),f(""),U(l=>l+1),x.success("已提交合作申请，我们会尽快联系您")};return t.jsxs("main",{className:"container mx-auto px-4 py-8 scroll-smooth","aria-label":"主要内容",children:[t.jsx(V,{title:"品牌合作",subtitle:"面向老字号品牌的共创入口：选择品牌、生成灵感、提交合作与管理申请",theme:"red",stats:[{label:"当前品牌",value:n.name},{label:"申请数量",value:b.length.toString()},{label:"状态",value:g},{label:"排序",value:u==="recent"?"最新":u==="old"?"最早":"状态"}],badgeText:"Beta",pattern:!0,size:"lg"}),t.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs(j.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25},className:`${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur lg:sticky lg:top-6`,id:"brand-section","aria-labelledby":"brand-section-title",children:[t.jsx("h2",{className:"text-base font-semibold mb-3",children:"选择老字号"}),t.jsx("label",{htmlFor:"brand-search",className:"sr-only",children:"搜索品牌名称"}),t.jsx("input",{value:N,onChange:e=>A(e.target.value),id:"brand-search",className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-2`,placeholder:"搜索品牌名称"}),t.jsx("select",{value:n.id,onChange:e=>D(v.find(a=>a.id===e.target.value)||v[0]),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2`,children:v.filter(e=>e.name.toLowerCase().includes(N.trim().toLowerCase())).map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))}),t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:n.image,alt:n.name,className:"w-full h-40 object-cover rounded-xl",loading:"lazy",decoding:"async"}),t.jsx("div",{className:`absolute inset-x-0 bottom-0 px-3 py-2 text-xs ${r?"bg-black/40 text-gray-200":"bg-white/50 text-gray-800"} rounded-b-xl backdrop-blur-sm`,children:n.name})]}),t.jsx("p",{className:`${r?"text-gray-400":"text-gray-600"} mt-3 text-sm leading-relaxed`,children:n.story})]})]}),t.jsxs(j.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.05},className:`lg:col-span-2 ${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur`,id:"ai-section","aria-labelledby":"ai-section-title",children:[t.jsx("div",{className:"mb-3",children:"AI聊天引导"}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:["赛博朋克风","校园潮流联名","数字文创表情包"].map((e,a)=>t.jsx("button",{className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-100 text-gray-900 hover:bg-gray-200"} text-xs px-3 py-1 rounded-full transition-colors`,onClick:()=>L(`把${n.name}做成${e}`),children:e},a))}),t.jsx("label",{htmlFor:"chat-input",className:"sr-only",children:"创作灵感输入框"}),t.jsx("textarea",{value:w,onChange:e=>L(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),B())},id:"chat-input","aria-describedby":"chat-hint",className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full h-32 px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2`,autoCapitalize:"none",autoCorrect:"off",enterKeyHint:"send",inputMode:"text"}),t.jsx("div",{id:"chat-hint",className:"mt-3 text-sm opacity-70",children:"示例：把麻花做成赛博朋克风"}),t.jsx(j.button,{whileHover:{scale:1.03},onClick:B,className:"mt-4 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white px-4 py-2 rounded-lg shadow min-h-[44px]",children:"生成灵感"}),z.length>0&&t.jsx("ul",{className:"mt-4 space-y-2 text-sm","aria-live":"polite",children:z.map((e,a)=>t.jsxs("li",{className:`${r?"bg-gray-700":"bg-gray-100"} px-3 py-2 rounded-lg flex items-center justify-between hover:bg-opacity-90 transition-colors`,children:[t.jsx("span",{className:"mr-2",children:e}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-2 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>f(e),children:"填入合作想法"}),t.jsx("button",{className:`${r?"bg-gray-600 hover:bg-gray-500 text-white":"bg-gray-300 hover:bg-gray-400 text-gray-900"} px-2 py-1 text-xs rounded`,onClick:async()=>{try{await navigator.clipboard.writeText(e),x.success("已复制到剪贴板")}catch{x.error("复制失败")}},children:"复制"})]})]},a))})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6",children:[t.jsxs(j.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.1},className:`${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur`,id:"apply-section","aria-labelledby":"apply-section-title",children:[t.jsx("div",{className:"font-medium mb-3",children:"提交品牌合作申请"}),t.jsx("label",{htmlFor:"contact-input",className:"sr-only",children:"联系人姓名"}),t.jsx("input",{id:"contact-input",value:p,onChange:e=>k(e.target.value),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-1 min-h-[44px]`,placeholder:"联系人姓名",autoCapitalize:"none",autoCorrect:"off"}),!d.nameOk&&t.jsx("div",{className:"mb-2 text-xs text-red-600",children:d.nameMsg}),t.jsx("label",{htmlFor:"phone-input",className:"sr-only",children:"联系方式（手机/微信）"}),t.jsx("input",{id:"phone-input",value:h,onChange:e=>$(e.target.value),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-1 min-h-[44px]`,placeholder:"联系方式（手机/微信）",autoCapitalize:"none",autoCorrect:"off",inputMode:"text",enterKeyHint:"next"}),!d.phoneOk&&t.jsx("div",{className:"mb-2 text-xs text-red-600",children:d.phoneMsg}),t.jsx("label",{htmlFor:"idea-input",className:"sr-only",children:"合作想法"}),t.jsx("textarea",{id:"idea-input",value:y,onChange:e=>f(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&O&&(e.preventDefault(),E())},className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full h-24 px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-2`,placeholder:`合作想法（基于 ${n.name} ）`,autoCapitalize:"none",autoCorrect:"off",enterKeyHint:"send"}),!d.ideaOk&&t.jsx("div",{className:"mb-3 text-xs text-red-600",children:d.ideaMsg}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:E,disabled:!O,"aria-disabled":!O,className:`bg-gradient-to-r from-red-600 to-pink-600 text-white px-4 py-2 rounded-lg shadow min-h-[44px] ${O?"hover:from-red-700 hover:to-pink-700":"opacity-50 cursor-not-allowed"}`,children:"提交申请"}),t.jsx("button",{onClick:()=>{k(""),$(""),f("")},className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-4 py-2 rounded-lg min-h-[44px]`,children:"清空表单"})]})]}),t.jsxs(j.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.15},className:`lg:col-span-2 ${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur`,id:"list-section","aria-labelledby":"list-section-title",children:[t.jsx("div",{className:"font-medium mb-3",children:"当前该品牌的合作申请"}),t.jsxs("div",{className:"mb-3 flex flex-wrap gap-2 items-center","aria-live":"polite",children:[t.jsx("button",{onClick:H,className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-3 py-2 rounded-lg transition-colors`,children:"导出JSON"}),t.jsx("button",{onClick:J,className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-3 py-2 rounded-lg transition-colors`,children:"导出CSV"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"全部",count:b.length},{key:"pending",label:"待处理",count:C.pending},{key:"negotiating",label:"洽谈中",count:C.negotiating},{key:"approved",label:"已通过",count:C.approved},{key:"rejected",label:"已拒绝",count:C.rejected}].map(e=>t.jsxs("button",{onClick:()=>F(e.key),className:`px-3 py-1 rounded-full text-sm ring-1 ${g===e.key?"bg-blue-600 text-white ring-blue-600":r?"bg-gray-800 text-gray-300 ring-gray-700":"bg-white text-gray-900 ring-gray-200"}`,children:[e.label,t.jsx("span",{className:`ml-2 inline-block px-2 py-0.5 rounded-full text-xs ${g===e.key?"bg-white text-blue-600":r?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:e.count})]},e.key))}),t.jsxs("select",{value:u,onChange:e=>R(e.target.value),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2`,children:[t.jsx("option",{value:"recent",children:"按更新时间(新→旧)"}),t.jsx("option",{value:"old",children:"按更新时间(旧→新)"}),t.jsx("option",{value:"status",children:"按状态"})]})]}),S.length===0?t.jsx("div",{className:"text-sm opacity-70",children:"暂无申请，欢迎成为第一个合作发起者～"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:`${r?"bg-gray-700":"bg-gray-100"}`,children:[t.jsx("th",{className:"text-left px-3 py-2",children:"品牌"}),t.jsx("th",{className:"text-left px-3 py-2",children:"说明"}),t.jsx("th",{className:"text-left px-3 py-2",children:"状态"}),t.jsx("th",{className:"text-left px-3 py-2",children:"奖励"}),t.jsx("th",{className:"text-left px-3 py-2",children:"更新时间"}),t.jsx("th",{className:"text-left px-3 py-2",children:"操作"})]})}),t.jsx("tbody",{children:S.map(e=>t.jsxs("tr",{className:`${r?"border-gray-700 hover:bg-gray-800/60":"border-gray-200 hover:bg-gray-50"} border-t transition-colors`,children:[t.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:e.brandLogo,alt:e.brandName,className:"w-8 h-8 rounded",loading:"lazy",decoding:"async"}),t.jsx("span",{children:e.brandName})]})}),t.jsx("td",{className:"px-3 py-2",children:e.description}),t.jsx("td",{className:"px-3 py-2",children:e.status}),t.jsx("td",{className:"px-3 py-2",children:e.reward}),t.jsx("td",{className:"px-3 py-2",children:new Date(e.updatedAt).toLocaleString()}),t.jsx("td",{className:"px-3 py-2",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>K(e.id,"negotiating"),className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-2 py-1 rounded transition-colors`,children:"标记洽谈"}),t.jsx("button",{onClick:()=>K(e.id,"approved"),className:"px-2 py-1 rounded bg-green-500 hover:bg-green-600 text-white transition-colors",children:"通过"}),t.jsx("button",{onClick:()=>K(e.id,"rejected"),className:"px-2 py-1 rounded bg-red-500 hover:bg-red-600 text-white transition-colors",children:"拒绝"})]})})]},e.id))})]})})]})]})]})}export{Q as default};
