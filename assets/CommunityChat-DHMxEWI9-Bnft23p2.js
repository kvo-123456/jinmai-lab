import{C as o,c as t,az as Q,aA as R,aB as C}from"./index-DvRCDgMZ.js";const E=({isDark:s,joinedCommunities:$,recommendedCommunities:u,userCommunities:h,activeChatCommunityId:x,onActiveChatCommunityChange:M,pinnedJoined:y,onTogglePinJoined:O,mutedCommunities:A,onToggleMuteCommunity:I,communityMessages:c,onCommunityMessagesChange:p,mockCreators:f})=>{const[b,L]=o.useState(""),[j,v]=o.useState(""),[k,S]=o.useState(!1),[g,N]=o.useState(null),[U,Y]=o.useState(""),D=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ‰","ğŸ˜®","ğŸ˜¢","ğŸ˜¡","ğŸ¤”","ğŸ‘€","ğŸ‘"],_=o.useMemo(()=>[...u,...h].filter(e=>$.includes(e.id)),[$,h,u]),z=o.useMemo(()=>{const e=b.trim().toLowerCase(),a=_.filter(n=>e?`${n.name} ${n.description} ${n.tags.join(" ")}`.toLowerCase().includes(e):!0),i=a.filter(n=>y.includes(n.id)),r=a.filter(n=>!y.includes(n.id));return[...i,...r]},[_,b,y]),T=(e,a)=>{const i=a.trim();if(!i)return;const r=f.find(m=>m.online)||f[0],n={id:`cm-${Date.now()}`,user:r.name,text:i,avatar:r.avatar,createdAt:Date.now(),replyTo:g?{id:g.id,user:g.user,text:g.text}:void 0,reactions:{}},d={...c,[e]:[n,...c[e]||[]]};p(d),localStorage.setItem("jmzf_community_messages",JSON.stringify(d)),C.success("å·²å‘é€åˆ°è¯¥ç¤¾ç¾¤"),v(""),N(null)},B=(e,a,i)=>{const r=(f.find(d=>d.online)||f[0]).name,n={...c,[e]:(c[e]||[]).map(d=>{if(d.id!==a)return d;const m={...d.reactions||{}},w=m[i]||[];return w.includes(r)?(m[i]=w.filter(H=>H!==r),m[i].length===0&&delete m[i]):m[i]=[...w,r],{...d,reactions:m}})};p(n),localStorage.setItem("jmzf_community_messages",JSON.stringify(n))},K=e=>{N(e)},P=()=>{N(null)},q=e=>{v(a=>a+e),S(!1)},F=(e,a)=>{const i={...c,[e]:(c[e]||[]).filter(r=>r.id!==a)};p(i),localStorage.setItem("jmzf_community_messages",JSON.stringify(i)),C.success("æ¶ˆæ¯å·²åˆ é™¤")},G=(e,a)=>{const i={...c,[e]:(c[e]||[]).map(r=>r.id===a?{...r,pinned:!r.pinned}:r)};p(i),localStorage.setItem("jmzf_community_messages",JSON.stringify(i)),C.success("ç½®é¡¶çŠ¶æ€å·²æ›´æ–°")},l=o.useMemo(()=>x&&[...u,...h].find(e=>e.id===x)||null,[x,u,h]),J=o.useMemo(()=>x?c[x]||[]:[],[x,c]);return t.jsxs(Q.section,{className:`mb-6 ${s?"bg-gray-800":"bg-white"} rounded-2xl shadow-md p-4`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"font-medium",children:"ç¤¾ç¾¤åˆ—è¡¨ä¸èŠå¤©"}),t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s?"bg-gray-700 text-gray-200":"bg-gray-100 text-gray-700"}`,children:"å¿«é€Ÿäº¤æµ"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"lg:col-span-1",children:[t.jsx("div",{className:"flex items-center gap-2 mb-2",children:t.jsx("input",{value:b,onChange:e=>L(e.target.value),placeholder:"æœç´¢å·²åŠ å…¥ç¤¾ç¾¤...",className:`${s?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg flex-1 focus:outline-none focus:ring-2 ${s?"focus:ring-purple-500":"focus:ring-pink-300"}`})}),t.jsx("ul",{className:"space-y-2 max-h-[38vh] overflow-y-auto sm:max-h-[50vh]",children:z.length===0?t.jsx("li",{className:"text-sm opacity-60",children:"æš‚æ— å·²åŠ å…¥ç¤¾ç¾¤"}):z.map(e=>t.jsx("li",{children:t.jsxs("button",{onClick:()=>M(e.id),className:`w-full text-left p-2 rounded-lg text-sm ring-1 transition-colors ${x===e.id?"bg-indigo-600 text-white ring-indigo-600":s?"bg-gray-700 text-white ring-gray-700":"bg-gray-100 text-gray-900 ring-gray-200"}`,children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("div",{className:"font-medium truncate mr-2",children:e.name})}),t.jsx("div",{className:"text-xs opacity-70 mt-1 text-gray-300",children:e.tags.slice(0,2).join(" Â· ")})]})},`chatlist-top-${e.id}`))})]}),t.jsx("div",{className:"lg:col-span-2",children:l?t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-medium",children:l.name}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>O(l.id),className:`${s?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"} text-xs px-3 py-1 rounded-full transition-colors`,children:y.includes(l.id)?"å–æ¶ˆç½®é¡¶":"ç½®é¡¶"}),t.jsx("button",{onClick:()=>I(l.id),className:`${s?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"} text-xs px-3 py-1 rounded-full transition-colors`,children:A.includes(l.id)?"å–æ¶ˆé™éŸ³":"é™éŸ³"})]})]}),t.jsx("div",{className:"space-y-3 mb-4 max-h-[40vh] sm:max-h-[50vh] overflow-y-auto pr-1",children:J.length===0?t.jsx("div",{className:"text-sm opacity-60 text-center py-4",children:"æš‚æ— æ¶ˆæ¯ï¼Œå¿«æ¥å‘ç¬¬ä¸€æ¡æ¶ˆæ¯å§ï¼"}):J.map(e=>t.jsx("div",{className:`p-3 rounded-xl ${s?"bg-gray-700":"bg-gray-100"}`,children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(R,{src:e.avatar,alt:e.user,size:"sm",className:"mr-3"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[e.replyTo&&t.jsxs("div",{className:`mb-2 p-2 rounded-lg text-xs ${s?"bg-gray-800 text-gray-300":"bg-gray-200 text-gray-700"}`,children:[t.jsxs("div",{className:"font-medium",children:["å›å¤ ",e.replyTo.user,":"]}),t.jsx("div",{className:"text-xs opacity-80 line-clamp-2",children:e.replyTo.text})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("div",{className:"text-sm font-medium truncate",children:e.user})}),t.jsx("div",{className:"text-xs text-gray-400",children:e.createdAt?new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),t.jsx("div",{className:`text-sm ${s?"text-gray-200":"text-gray-800"} mb-2 break-words`,children:e.text}),e.reactions&&Object.keys(e.reactions).length>0&&t.jsx("div",{className:"flex items-center gap-1 mb-2 flex-wrap",children:Object.entries(e.reactions).map(([a,i])=>t.jsxs("button",{onClick:()=>e.id&&B(l.id,e.id,a),className:`flex items-center gap-1 px-2 py-0.5 rounded-full text-xs ${s?"bg-gray-800 text-white hover:bg-gray-700":"bg-white text-gray-800 hover:bg-gray-200"} ring-1 ${s?"ring-gray-700":"ring-gray-300"} transition-colors`,children:[t.jsx("span",{children:a}),t.jsx("span",{children:i.length})]},a))}),t.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[t.jsx("button",{onClick:()=>e.id&&K(e),className:`${s?"bg-gray-800 text-white":"bg-white text-gray-800"} px-2 py-0.5 rounded-lg text-xs ring-1 ${s?"ring-gray-700":"ring-gray-300"} transition-colors`,children:"å›å¤"}),t.jsx("button",{onClick:()=>e.id&&G(l.id,e.id),className:`${s?"bg-gray-800 text-white":"bg-white text-gray-800"} px-2 py-0.5 rounded-lg text-xs ring-1 ${s?"ring-gray-700":"ring-gray-300"} transition-colors`,children:e.pinned?"å–æ¶ˆç½®é¡¶":"ç½®é¡¶"}),t.jsx("button",{onClick:()=>e.id&&F(l.id,e.id),className:`${s?"bg-red-700 text-white":"bg-red-100 text-red-800"} px-2 py-0.5 rounded-lg text-xs transition-colors`,children:"åˆ é™¤"})]})]})]})},e.id))}),g&&t.jsxs("div",{className:`flex items-center gap-2 mb-2 p-2 rounded-lg ${s?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:[t.jsxs("div",{className:"text-sm",children:["å›å¤ ",g.user,":"]}),t.jsx("button",{onClick:P,className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-gray-800 text-white":"bg-white text-gray-800"}`,children:"å–æ¶ˆ"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{value:j,onChange:e=>v(e.target.value),onKeyPress:e=>e.key==="Enter"&&T(l.id,j),placeholder:g?`å›å¤ ${g.user}...`:"å‘è¡¨ä½ çš„çœ‹æ³•...",className:`w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${s?"bg-gray-700 text-white ring-1 ring-gray-600 focus:ring-purple-500":"bg-white text-gray-900 ring-1 ring-gray-300 focus:ring-pink-300"}`}),t.jsxs("div",{className:"relative",children:[t.jsx("button",{onClick:()=>S(!k),className:`absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full ${s?"hover:bg-gray-600 text-white":"hover:bg-gray-200 text-gray-800"}`,children:"ğŸ˜Š"}),k&&t.jsx("div",{className:`absolute bottom-full right-0 mb-2 p-2 rounded-lg shadow-lg z-10 ${s?"bg-gray-800 ring-1 ring-gray-700":"bg-white ring-1 ring-gray-300"}`,children:t.jsx("div",{className:"grid grid-cols-5 gap-2",children:D.map(e=>t.jsx("button",{onClick:()=>q(e),className:`text-xl p-1 rounded-full ${s?"hover:bg-gray-700":"hover:bg-gray-200"}`,children:e},e))})})]})]}),t.jsx("button",{onClick:()=>T(l.id,j),className:"px-3 py-2 rounded-lg bg-gradient-to-r from-red-600 to-pink-600 text-white transition-colors hover:opacity-90",children:"å‘é€"})]})]}):t.jsx("div",{className:`flex items-center justify-center h-72 rounded-lg ${s?"bg-gray-700":"bg-gray-100"}`,children:t.jsx("div",{className:"text-sm opacity-60",children:"è¯·é€‰æ‹©ä¸€ä¸ªç¤¾ç¾¤å¼€å§‹èŠå¤©"})})})]})]})};export{E as default};
