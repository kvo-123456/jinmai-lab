import{aD as ce,C as l,c as e,aS as Se,az as b,aE as pe,aB as k,b0 as K,ay as le}from"./index-DvRCDgMZ.js";import Ce from"./CulturalMatchingGame-DqPNqUBU-BqxOPxdo.js";var Ie=Object.defineProperty,Te=(g,s,t)=>s in g?Ie(g,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[s]=t,q=(g,s,t)=>Te(g,typeof s!="symbol"?s+"":s,t);class _e{constructor(s="jinmai_game"){q(this,"prefix"),this.prefix=s}save(s,t){try{const a={data:t,timestamp:Date.now()};localStorage.setItem(`${this.prefix}_${s}`,JSON.stringify(a))}catch(a){console.error("Failed to save game data:",a)}}load(s,t){try{const a=localStorage.getItem(`${this.prefix}_${s}`);if(a)return JSON.parse(a).data}catch(a){console.error("Failed to load game data:",a)}return t}clear(s){try{localStorage.removeItem(`${this.prefix}_${s}`)}catch(t){console.error("Failed to clear game data:",t)}}clearAll(){try{Object.keys(localStorage).forEach(s=>{s.startsWith(this.prefix)&&localStorage.removeItem(s)})}catch(s){console.error("Failed to clear all game data:",s)}}getAllKeys(){try{return Object.keys(localStorage).filter(s=>s.startsWith(this.prefix)).map(s=>s.replace(`${this.prefix}_`,""))}catch(s){return console.error("Failed to get all game keys:",s),[]}}}const ve=new _e;class Pe{constructor(){q(this,"questions",[]),q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextQuestionId",1),q(this,"nextLevelId",1),this.initQuestions(),this.initLevels(),this.loadGameProgress()}initQuestions(){this.questions=[{id:`question-${this.nextQuestionId++}`,type:"single",title:"天津文化常识",content:"天津的市花是什么？",options:["梅花","月季","菊花","牡丹"],correctAnswers:[1],explanation:"天津的市花是月季，象征着天津人民的热情和活力。",hint:"天津的市花是一种四季常开的花卉。",culturalTheme:"天津地方文化",category:"天津文化"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"天津传统小吃",content:'天津的传统名吃"狗不理包子"的创始人是谁？',options:["张三","李四","王五","高贵友"],correctAnswers:[3],explanation:'狗不理包子的创始人是高贵友，因其乳名"狗子"，且卖包子时忙于生意不与人说话，被顾客戏称为"狗不理"。',hint:'创始人的乳名是"狗子"。',culturalTheme:"天津地方文化",category:"天津美食"},{id:`question-${this.nextQuestionId++}`,type:"multiple",title:"天津文化遗产",content:"以下哪些是天津的国家级非物质文化遗产？",options:["杨柳青年画","泥人张彩塑","天津相声","狗不理包子制作技艺"],correctAnswers:[0,1,2,3],explanation:"杨柳青年画、泥人张彩塑、天津相声和狗不理包子制作技艺均为天津的国家级非物质文化遗产。",hint:"这些都是天津的传统特色文化。",culturalTheme:"天津地方文化",category:"天津文化遗产"},{id:`question-${this.nextQuestionId++}`,type:"judgment",title:"天津历史",content:"天津是中国北方最早开放的通商口岸之一。",correctAnswers:[0],explanation:"天津是中国北方最早开放的通商口岸之一，自1860年开埠以来，逐渐发展成为重要的工商业城市。",hint:"天津开埠时间较早。",culturalTheme:"天津地方文化",category:"天津历史"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"天津方言",content:'天津方言中"嘛意思"是什么意思？',options:["什么意思","没关系","不用谢","再见"],correctAnswers:[0],explanation:'"嘛意思"是天津方言中"什么意思"的常用表达。',hint:'"嘛"是天津方言中的疑问词。',culturalTheme:"天津地方文化",category:"天津方言"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"中国传统节日",content:"以下哪个节日是中国的传统节日？",options:["情人节","圣诞节","中秋节","感恩节"],correctAnswers:[2],explanation:"中秋节是中国的传统节日，每年农历八月十五，人们会赏月、吃月饼。",hint:"这个节日与月亮有关。",culturalTheme:"中国传统文化",category:"传统节日"},{id:`question-${this.nextQuestionId++}`,type:"multiple",title:"中国传统绘画",content:"以下哪些是中国传统绘画的主要形式？",options:["国画","油画","水彩画","工笔画"],correctAnswers:[0,3],explanation:"国画和工笔画是中国传统绘画的主要形式，油画和水彩画是西方绘画形式。",hint:"这些是中国本土的绘画形式。",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`question-${this.nextQuestionId++}`,type:"judgment",title:"中国传统哲学",content:'儒家思想的核心是"仁、义、礼、智、信"。',correctAnswers:[0],explanation:'儒家思想的核心是"仁、义、礼、智、信"，这是中国传统文化的重要组成部分。',hint:"这是孔子思想的核心。",culturalTheme:"中国传统文化",category:"传统哲学"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"中国传统工艺",content:"青花瓷是中国哪个朝代的代表性瓷器？",options:["唐朝","宋朝","元朝","明朝"],correctAnswers:[2],explanation:"青花瓷起源于唐朝，但在元朝达到鼎盛，成为中国瓷器的代表品种之一。",hint:"这个朝代是蒙古族建立的。",culturalTheme:"中国传统文化",category:"传统工艺"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"中国传统医学",content:'中医理论中的"五脏六腑"不包括以下哪个器官？',options:["心脏","肝脏","脾脏","胰腺"],correctAnswers:[3],explanation:'中医理论中的"五脏"指心、肝、脾、肺、肾，"六腑"指胆、胃、小肠、大肠、膀胱、三焦，不包括胰腺。',hint:"这个器官在西医中很重要，但中医理论中没有单独列出。",culturalTheme:"中国传统文化",category:"传统医学"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化入门",description:"了解天津的基本文化常识",questions:this.questions.slice(0,5),gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁天津文化素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20heritage%20tourism"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化基础",description:"了解中国传统文化的基本常识",questions:this.questions.slice(5,10),gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统文化素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20culture%20collection"},{id:`level-${this.nextLevelId++}`,name:"文化知识挑战",description:"综合挑战天津文化和中国传统文化知识",questions:[...this.questions.slice(0,3),...this.questions.slice(5,8)],gridSize:{rows:4,cols:5},difficulty:"hard",unlockCondition:{type:"level",value:2},reward:"解锁高级文化素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20knowledge%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getQuestions(){return[...this.questions]}getQuestionById(s){return this.questions.find(t=>t.id===s)}loadGameProgress(){const s=ve.load("quiz_game_progress",new Map);s instanceof Map?this.gameProgress=s:this.gameProgress=new Map(Object.entries(s||{}))}saveGameProgress(){const s=Object.fromEntries(this.gameProgress.entries());ve.save("quiz_game_progress",s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},unlockedHints:3,bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t),this.saveGameProgress()}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),this.saveGameProgress(),a}checkAnswer(s,t){const a=[...s.correctAnswers].sort(),r=[...t].sort();if(a.length!==r.length)return!1;for(let n=0;n<a.length;n++)if(a[n]!==r[n])return!1;return!0}calculateQuestionScore(s,t,a){let r=0;return t&&(r=10,a&&a<10?r+=5:a&&a<20&&(r+=3),s.type==="multiple"?r+=5:s.type==="judgment"&&(r+=2)),r}calculateLevelScore(s,t,a,r){const n=s/t,x=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[r]||.5,i=t*20,j=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[r]||1;return Math.round((x+j)*p)}completeLevel(s,t,a,r){const n=this.getGameProgress(s),x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),this.saveGameProgress(),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),this.saveGameProgress(),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1}),this.saveGameProgress()}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const me=new Pe,Le=({isOpen:g,onClose:s})=>{var t;const{isDark:a}=ce(),{user:r}=l.useContext(pe),[n,x]=l.useState("menu"),[w,i]=l.useState([]),[j,p]=l.useState(null),[S,h]=l.useState(0),[$,u]=l.useState(null),[_,T]=l.useState([]),[I,W]=l.useState(!1),[L,M]=l.useState(!1),[H,D]=l.useState(0),[P,z]=l.useState(null),[O,R]=l.useState(null),[A,Q]=l.useState(null),[X,te]=l.useState(!1),[F,J]=l.useState(!0),[Z,c]=l.useState(0);l.useEffect(()=>{if(g){J(!0);try{const o=me.getLevels();if(i(o),r){const C=me.getGameProgress(r.id);z(C)}}catch(o){console.error("加载游戏数据失败:",o)}finally{J(!1)}}},[g,r]),l.useEffect(()=>{j&&(h(0),u(j.questions[0]),T([]),W(!1),M(!1),D(0),x("playing"),R(new Date),Q(null),te(!1),c(0))},[j]),l.useEffect(()=>{j&&j.questions[S]&&(u(j.questions[S]),T([]),W(!1),M(!1),te(!1))},[j,S]),l.useEffect(()=>{let o;return O&&n==="playing"&&(o=setInterval(()=>{const C=Math.round((new Date().getTime()-O.getTime())/1e3);c(C)},1e3)),()=>clearInterval(o)},[O,n]);const d=l.useCallback(o=>{if(!r){k.error("请先登录！");return}me.isLevelUnlocked(r.id,o.id)?p(o):k.error("该关卡尚未解锁！")},[r]),N=l.useCallback(o=>{I||$&&($.type==="single"?T([o]):T(C=>C.includes(o)?C.filter(v=>v!==o):[...C,o]))},[$,I]),U=l.useCallback(()=>{if(!$||_.length===0){k.error("请选择答案！");return}const o=me.checkAnswer($,_);W(!0),M(o),o?(D(C=>C+1),k.success("回答正确！")):k.error("回答错误")},[$,_]),ee=l.useCallback(()=>{j&&(S<j.questions.length-1?h(o=>o+1):y())},[S,j]),y=l.useCallback(()=>{if(!r||!j)return;const o=O?Math.round((new Date().getTime()-O.getTime())/1e3):0;Q(o);const C=me.calculateLevelScore(H,j.questions.length,o,j.difficulty),v=me.completeLevel(r.id,j.id,C,o);z(v),x("completed"),k.success(`关卡完成！得分：${C}`)},[r,j,H,O]),B=l.useCallback(()=>{if(!(!r||!P||!$))if(me.useHint(r.id)){te(!0);const o=me.getGameProgress(r.id);z(o),k.success("已显示提示")}else k.error("提示已用完")},[r,P,$]),m=l.useCallback(()=>{x("menu"),p(null),u(null),h(0),T([]),W(!1),M(!1),D(0),R(null),Q(null),te(!1),c(0)},[]),E=l.useCallback(()=>{j&&(h(0),u(j.questions[0]),T([]),W(!1),M(!1),D(0),x("playing"),R(new Date),Q(null),te(!1),c(0))},[j]),V=l.useCallback(o=>{if(!o)return"00:00";const C=Math.floor(o/60),v=o%60;return`${C.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:o=>o.target===o.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-2xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${a?"bg-gray-800":"bg-white"} text-${a?"white":"gray-900"} flex flex-col`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${a?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化知识挑战"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${a?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[F&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:n==="menu"&&!F&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化知识挑战"}),e.jsx("p",{className:`${a?"text-gray-400":"text-gray-600"}`,children:"测试你对天津地方文化和中国传统文化的了解"})]}),P&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:P.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:P.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:P.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:w.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.map(o=>{const C=(P==null?void 0:P.completedLevels.includes(o.id))||!1,v=!r||me.isLevelUnlocked(r.id,o.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${a?"border-gray-700":"border-gray-200"} ${v?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:v?{y:-4}:{},onClick:()=>v&&d(o),children:[o.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:o.imageUrl,alt:o.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),C&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!v&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:o.name}),e.jsx("p",{className:`text-sm mb-2 ${a?"text-gray-400":"text-gray-600"}`,children:o.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${a?"bg-gray-700":"bg-gray-100"}`,children:o.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a?"bg-gray-700":"bg-gray-100"}`,children:[o.questions.length," 题"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${a?"bg-gray-700":"bg-gray-100"}`,children:o.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[o.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",V(o.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",o.reward]})]})]},o.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:n==="playing"&&j&&$&&!F&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:j.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:m,className:`px-3 py-1 rounded-lg text-sm transition-colors ${a?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:B,disabled:!P||P.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${a?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(P==null?void 0:P.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${a?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"题目进度"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:S+1}),e.jsxs("span",{className:"text-xs",children:["/ ",j.questions.length]})]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${a?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"正确题数"}),e.jsx("span",{className:"font-medium",children:H})]}),e.jsxs("div",{className:`p-2 rounded-lg ${a?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"用时"}),e.jsx("span",{className:"font-medium",children:V(Z)})]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"text-lg font-medium mb-2",children:$.title}),e.jsx("p",{className:`mb-4 ${a?"text-gray-300":"text-gray-700"}`,children:$.content}),X&&$.hint&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${a?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${a?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mt-1 mr-2"}),e.jsx("p",{className:`text-sm ${a?"text-yellow-200":"text-yellow-800"}`,children:$.hint})]})}),e.jsx("div",{className:"space-y-3",children:(t=$.options)==null?void 0:t.map((o,C)=>e.jsx(b.button,{className:`w-full p-3 rounded-lg text-left transition-all ${a?"bg-gray-800 hover:bg-gray-700":"bg-white hover:bg-gray-50"} border ${a?"border-gray-700":"border-gray-200"} ${_.includes(C)?I?L?"border-green-500 bg-green-500 bg-opacity-10":"border-red-500 bg-red-500 bg-opacity-10":"border-blue-500 bg-blue-500 bg-opacity-10":""} ${I&&$.correctAnswers.includes(C)?"border-green-500 bg-green-500 bg-opacity-10":""}`,whileHover:_.length===0?{scale:1.02}:{},onClick:()=>N(C),disabled:I,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center mr-3 border ${_.includes(C)?I?L?"border-green-500 bg-green-500 text-white":"border-red-500 bg-red-500 text-white":"border-blue-500 bg-blue-500 text-white":I&&$.correctAnswers.includes(C)?"border-green-500 bg-green-500 text-white":a?"border-gray-600":"border-gray-300"}`,children:String.fromCharCode(65+C)}),e.jsx("span",{children:o})]})},C))}),I&&e.jsxs("div",{className:`mt-4 p-3 rounded-lg ${L?a?"bg-green-900 bg-opacity-30":"bg-green-100":a?"bg-red-900 bg-opacity-30":"bg-red-100"} border ${L?a?"border-green-700":"border-green-200":a?"border-red-700":"border-red-200"}`,children:[e.jsx("h5",{className:"font-medium mb-2",children:"答案解析"}),e.jsx("p",{className:a?"text-gray-300":"text-gray-700",children:$.explanation})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:I?e.jsx("button",{onClick:ee,className:`px-4 py-2 rounded-lg transition-colors ${a?"bg-green-600 hover:bg-green-700":"bg-green-500 hover:bg-green-600"} text-white`,children:S<j.questions.length-1?"下一题":"完成关卡"}):e.jsx("button",{onClick:U,disabled:_.length===0,className:`px-4 py-2 rounded-lg transition-colors ${a?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:"提交答案"})})]},"playing")}),e.jsx(K,{mode:"wait",children:n==="completed"&&j&&P&&!F&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${a?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",j.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${a?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:P.levelScores[j.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:V(A||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsxs("p",{className:"text-xl font-bold",children:[Math.round(H/j.questions.length*100),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"正确题数"}),e.jsxs("p",{className:"text-xl font-bold",children:[H," / ",j.questions.length]})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${a?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${a?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:a?"text-yellow-200":"text-yellow-800",children:j.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:E,className:`px-4 py-2 rounded-lg transition-colors ${a?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:m,className:`px-4 py-2 rounded-lg transition-colors ${a?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class ze{constructor(){q(this,"cardDatabase",[]),q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextCardId",1),q(this,"nextLevelId",1),this.initCardDatabase(),this.initLevels(),this.loadGameProgress()}initCardDatabase(){[{name:"天津之眼",description:"天津标志性建筑，是世界上唯一一个桥上瞰景摩天轮。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20Eye%20ferris%20wheel%20night%20view",culturalTheme:"天津地方文化",category:"地标建筑"},{name:"杨柳青年画",description:"中国著名的民间木版年画，源于天津杨柳青镇。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Yangliuqing%20New%20Year%20paintings%20traditional%20Chinese%20folk%20art",culturalTheme:"天津地方文化",category:"传统艺术"},{name:"泥人张彩塑",description:"天津传统民间艺术，以泥塑造各种人物形象。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Nirenzhang%20clay%20sculptures%20traditional%20Tianjin%20art",culturalTheme:"天津地方文化",category:"传统工艺"},{name:"狗不理包子",description:"天津传统名吃，以皮薄馅大、味道鲜美著称。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Goubuli%20steamed%20buns%20traditional%20Tianjin%20food",culturalTheme:"天津地方文化",category:"传统美食"},{name:"天津相声",description:"中国北方传统曲艺形式，天津是相声的重要发源地。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20cross-talk%20traditional%20Chinese%20comedy",culturalTheme:"天津地方文化",category:"传统曲艺"},{name:"瓷房子",description:"天津特色建筑，用数万件古董瓷器装饰而成。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Porcelain%20House%20Tianjin%20China%20unique%20architecture",culturalTheme:"天津地方文化",category:"特色建筑"},{name:"古文化街",description:"天津著名的文化旅游街区，展示传统民俗文化。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20Ancient%20Culture%20Street%20traditional%20architecture",culturalTheme:"天津地方文化",category:"文化街区"},{name:"麻花",description:"天津传统小吃，酥脆香甜，造型独特。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20twisted%20dough%20sticks%20traditional%20snack",culturalTheme:"天津地方文化",category:"传统美食"},{name:"京剧脸谱",description:"京剧艺术中的重要元素，通过不同颜色和图案表达人物性格。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Peking%20Opera%20facial%20makeup%20traditional%20Chinese%20art",culturalTheme:"中国传统文化",category:"传统艺术"},{name:"故宫",description:"中国明清两代的皇家宫殿，世界上现存规模最大、保存最为完整的木质结构古建筑之一。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Forbidden%20City%20Beijing%20China%20ancient%20palace",culturalTheme:"中国传统文化",category:"历史建筑"},{name:"长城",description:"中国古代的军事防御工程，是世界七大奇迹之一。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Great%20Wall%20of%20China%20mountain%20scenery",culturalTheme:"中国传统文化",category:"历史遗迹"},{name:"兵马俑",description:'秦始皇陵中的陶俑群，被誉为"世界第八大奇迹"。',imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Terracotta%20Army%20Xi%27an%20China%20ancient%20sculptures",culturalTheme:"中国传统文化",category:"历史文物"},{name:"青花瓷",description:"中国传统瓷器工艺，以白地蓝花为主要特征。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Blue%20and%20white%20porcelain%20traditional%20Chinese%20craft",culturalTheme:"中国传统文化",category:"传统工艺"},{name:"书法",description:"中国特有的传统艺术，通过汉字的书写表现美感。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Chinese%20calligraphy%20traditional%20art%20brush%20writing",culturalTheme:"中国传统文化",category:"传统艺术"},{name:"剪纸",description:"中国传统民间艺术，用剪刀或刻刀在纸上剪刻图案。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Chinese%20paper%20cutting%20traditional%20folk%20art",culturalTheme:"中国传统文化",category:"传统工艺"},{name:"中国结",description:"中国传统手工艺品，象征着团结、幸福和吉祥。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Chinese%20knot%20traditional%20decoration%20red%20thread",culturalTheme:"中国传统文化",category:"传统工艺"}].forEach(s=>{const t=`pair-${this.nextCardId}`;for(let a=0;a<2;a++)this.cardDatabase.push({id:`card-${this.nextCardId}-${a+1}`,pairId:t,name:s.name,description:s.description,imageUrl:s.imageUrl,culturalTheme:s.culturalTheme,category:s.category,isFlipped:!1,isMatched:!1,isSelected:!1});this.nextCardId++})}initLevels(){const s=this.getShuffledCards(8),t=this.getShuffledCards(12),a=this.getShuffledCards(16);this.levels=[{id:`memory-level-${this.nextLevelId++}`,name:"文化记忆入门",description:"了解天津和中国传统文化的基本元素",cards:s,gridSize:{rows:4,cols:4},difficulty:"easy",timeLimit:180,reward:"解锁文化记忆入门徽章",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Memory%20game%20easy%20level%20cultural%20elements"},{id:`memory-level-${this.nextLevelId++}`,name:"文化记忆挑战",description:"挑战你的文化记忆能力，识别更多文化元素",cards:t,gridSize:{rows:6,cols:6},difficulty:"medium",unlockCondition:{type:"level",value:1},timeLimit:300,reward:"解锁文化记忆挑战徽章",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Memory%20game%20medium%20level%20cultural%20elements"},{id:`memory-level-${this.nextLevelId++}`,name:"文化记忆大师",description:"成为文化记忆大师，挑战最难的记忆关卡",cards:a,gridSize:{rows:8,cols:8},difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:600,reward:"解锁文化记忆大师徽章",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Memory%20game%20hard%20level%20cultural%20elements"}]}getShuffledCards(s){const t=this.nextCardId-1,a=Math.min(s,t),r=Array.from({length:t},(i,j)=>`pair-${j+1}`),n=this.shuffleArray(r),x=new Set(n.slice(0,a)),w=this.cardDatabase.filter(i=>x.has(i.pairId));return this.shuffleArray([...w]).map(i=>({...i,isFlipped:!1,isMatched:!1,isSelected:!1}))}shuffleArray(s){const t=[...s];for(let a=t.length-1;a>0;a--){const r=Math.floor(Math.random()*(a+1));[t[a],t[r]]=[t[r],t[a]]}return t}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getLevelCards(s){const t=this.getLevelById(s);if(t)return JSON.parse(JSON.stringify(t.cards))}loadGameProgress(){const s=ve.load("memory_game_progress",new Map);s instanceof Map?this.gameProgress=s:this.gameProgress=new Map(Object.entries(s||{}))}saveGameProgress(){const s=Object.fromEntries(this.gameProgress.entries());ve.save("memory_game_progress",s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t),this.saveGameProgress()}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),this.saveGameProgress(),a}calculateScore(s,t,a,r){const n=s/t,x=Math.round(1e3*n),w={easy:.5,medium:1,hard:1.5}[r],i={easy:10,medium:8,hard:6}[r],j=t*i,p=Math.max(0,j-a)*w,S={easy:1,medium:1.5,hard:2}[r];return Math.round((x+p)*S)}completeLevel(s,t,a,r){const n=this.getGameProgress(s);if(!this.getLevelById(t))return n;const x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),this.saveGameProgress(),w}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const ye=new ze,Ue=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState([]),[h,$]=l.useState([]),[u,_]=l.useState(0),[T,I]=l.useState(!1),[W,L]=l.useState(null),[M,H]=l.useState(0),[D,P]=l.useState(null),[z,O]=l.useState(null),[R,A]=l.useState(!0);l.useEffect(()=>{if(g){A(!0);try{const c=ye.getLevels();if(w(c),a){const d=ye.getGameProgress(a.id);O(d)}}catch(c){console.error("加载游戏数据失败:",c)}finally{A(!1)}}},[g,a]),l.useEffect(()=>{let c;return W&&r==="playing"&&(c=setInterval(()=>{const d=Math.round((new Date().getTime()-W.getTime())/1e3);H(d)},1e3)),()=>clearInterval(c)},[W,r]),l.useEffect(()=>{if(i){const c=ye.getLevelCards(i.id);c&&(S(c),$([]),_(0),n("playing"),L(new Date),H(0),P(null),I(!1))}},[i]),l.useEffect(()=>{if(i&&r==="playing"){const c=i.cards.length/2;u===c&&te()}},[u,i,r]);const Q=l.useCallback(c=>{if(!a){k.error("请先登录！");return}ye.isLevelUnlocked(a.id,c.id)?j(c):k.error("该关卡尚未解锁！")},[a]),X=l.useCallback(c=>{r!=="playing"||T||c.isFlipped||c.isMatched||h.length>=2||(S(d=>d.map(N=>N.id===c.id?{...N,isFlipped:!0}:N)),$(d=>{const N=[...d,{...c,isFlipped:!0}];if(N.length===2){I(!0);const[U,ee]=N,y=U.pairId===ee.pairId;setTimeout(()=>{S(B=>{if(y){const m=B.map(E=>E.pairId===U.pairId?{...E,isMatched:!0,isFlipped:!0}:E);return _(E=>E+1),k.success("配对成功！"),m}else return B.map(m=>m.id===U.id||m.id===ee.id?{...m,isFlipped:!1}:m)}),$([]),I(!1)},800)}return N}))},[r,T]),te=l.useCallback(()=>{if(!a||!i)return;const c=W?Math.round((new Date().getTime()-W.getTime())/1e3):0;P(c);const d=i.cards.length/2,N=ye.calculateScore(u,d,c,i.difficulty),U=ye.completeLevel(a.id,i.id,N,c);O(U),n("completed"),k.success(`关卡完成！得分：${N}`)},[a,i,u,W]),F=l.useCallback(()=>{n("menu"),j(null),S([]),$([]),_(0),L(null),H(0),P(null),I(!1)},[]),J=l.useCallback(()=>{if(!i)return;const c=ye.getLevelCards(i.id);c&&(S(c),$([]),_(0),n("playing"),L(new Date),H(0),P(null),I(!1))},[i]),Z=l.useCallback(c=>{const d=Math.floor(c/60),N=c%60;return`${d.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:c=>c.target===c.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化记忆游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[R&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!R&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化记忆游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"翻牌匹配相同的文化元素，挑战你的记忆力和文化知识"})]}),z&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:z.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:z.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最佳时间"}),e.jsx("p",{className:"text-xl font-bold",children:z.bestTimes&&Object.keys(z.bestTimes).length>0?Z(Math.min(...Object.values(z.bestTimes))):"--:--"})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(c=>{const d=(z==null?void 0:z.completedLevels.includes(c.id))||!1,N=!a||ye.isLevelUnlocked((a==null?void 0:a.id)||"",c.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${N?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:N?{y:-4}:{},onClick:()=>N&&Q(c),children:[c.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),d&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!N&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:c.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:c.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:c.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[c.gridSize.rows,"x",c.gridSize.cols]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[c.cards.length/2," 对卡片"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[c.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",Z(c.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",c.reward]})]})]},c.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&!R&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 md:mb-0",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:Z(M)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已匹配"}),e.jsxs("span",{className:"font-medium",children:[u," / ",i.cards.length/2]})]}),e.jsx("button",{onClick:F,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"})]})]})}),e.jsx("div",{className:"grid gap-2 mb-6 mx-auto",style:{gridTemplateColumns:`repeat(${i.gridSize.cols}, 1fr)`,maxWidth:"600px"},children:p.map(c=>e.jsx(b.div,{className:"aspect-square perspective-1000",onClick:()=>X(c),children:e.jsxs(b.div,{className:"relative w-full h-full cursor-pointer",style:{transformStyle:"preserve-3d",transition:"transform 0.6s"},animate:{rotateY:c.isFlipped||c.isMatched?180:0},transition:{duration:.5},children:[e.jsx(b.div,{className:`absolute w-full h-full backface-hidden rounded-lg flex items-center justify-center transition-all ${t?"bg-gradient-to-br from-red-600 to-purple-600":"bg-gradient-to-br from-blue-500 to-purple-500"} shadow-md`,style:{transform:"rotateY(180deg)",backfaceVisibility:"hidden"},children:c.isMatched?e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},children:e.jsx("i",{className:"fas fa-check-circle text-4xl text-green-500"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-2",children:[e.jsx(le,{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover rounded-lg mb-2",ratio:"square",fit:"cover"}),e.jsx("p",{className:"text-sm font-medium text-center",children:c.name})]})}),e.jsx(b.div,{className:`absolute w-full h-full backface-hidden rounded-lg flex items-center justify-center ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"} border ${t?"border-gray-600":"border-gray-300"} shadow-md transition-all`,style:{backfaceVisibility:"hidden"},children:e.jsx("div",{className:"text-2xl",children:e.jsx("i",{className:"fas fa-question-circle"})})})]})},c.id))}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"font-medium mb-2",children:"游戏提示"}),e.jsx("p",{className:`text-sm ${t?"text-gray-300":"text-gray-700"}`,children:"点击卡片查看文化元素，记住它们的位置，然后找出所有配对的卡片。 配对成功后，你可以看到文化元素的详细信息。"})]})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&z&&!R&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:z.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:Z(D||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总配对数"}),e.jsx("p",{className:"text-xl font-bold",children:i.cards.length/2})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsx("button",{onClick:J,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:F,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null},$e="cultural_puzzle_game_progress",je=[{id:"level1",name:"天津之眼",description:"天津地标建筑，世界上唯一建在桥上的摩天轮",imageUrl:"https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?w=1024&h=768&fit=crop",difficulty:"easy",pieceCount:16,rows:4,cols:4,timeLimit:300,reward:"100积分 + 1个提示",culturalTheme:"天津地标",unlockedHints:2},{id:"level2",name:"古文化街",description:"天津最具代表性的古文化街区，展示天津民俗文化",imageUrl:"https://images.unsplash.com/photo-1549298916-b41d501d3772?w=1024&h=768&fit=crop",difficulty:"medium",pieceCount:25,rows:5,cols:5,timeLimit:480,reward:"150积分 + 2个提示",culturalTheme:"天津民俗",unlockedHints:3},{id:"level3",name:"泥人张彩塑",description:"天津传统民间艺术，国家级非物质文化遗产",imageUrl:"https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?w=1024&h=768&fit=crop",difficulty:"hard",pieceCount:36,rows:6,cols:6,timeLimit:600,reward:"200积分 + 3个提示",culturalTheme:"天津非遗",unlockedHints:4}],De=g=>{const s=[],t=100/g.cols,a=100/g.rows;let r=0;for(let n=0;n<g.rows;n++)for(let x=0;x<g.cols;x++)s.push({id:r++,x:Math.random()*100,y:Math.random()*100,width:t,height:a,correctX:x*t,correctY:n*a,isPlaced:!1,imageUrl:g.imageUrl});return Ae(s)},Me=(g,s,t)=>Math.abs(s-g.correctX)<=5&&Math.abs(t-g.correctY)<=5,Ge=g=>g.every(s=>s.isPlaced),He=(g,s,t,a)=>{let r=1e3;const n={easy:1,medium:1.5,hard:2},x=Math.max(0,1-s/g.timeLimit),w=r*x,i=Math.max(0,1-t/(g.pieceCount*2)),j=r*i,p=a*50,S=Math.round((w+j)/2*n[g.difficulty]-p);return Math.max(0,S)},Ee=()=>je,qe=g=>je.find(s=>s.id===g),Oe=(g,s)=>{const t=Ne(g);if(s==="level1")return!0;const a=je.findIndex(r=>r.id===s);if(a>0){const r=je[a-1].id;return t.completedLevels.includes(r)}return!1},Ne=g=>{try{const s=localStorage.getItem($e);if(s){const t=JSON.parse(s);if(t[g])return{...t[g],lastPlayed:new Date(t[g].lastPlayed)}}}catch(s){console.error("读取游戏进度失败:",s)}return{userId:g,completedLevels:[],levelScores:{},totalScore:0,unlockedHints:3,lastPlayed:new Date}},ke=g=>{try{const s=localStorage.getItem($e),t=s?JSON.parse(s):{};t[g.userId]={...g,lastPlayed:new Date},localStorage.setItem($e,JSON.stringify(t))}catch(s){console.error("保存游戏进度失败:",s)}},We=(g,s,t,a)=>{const r=Ne(g);if(r.completedLevels.includes(s)||r.completedLevels.push(s),!r.levelScores[s]||t>r.levelScores[s]){r.levelScores[s]=t;const n=Object.values(r.levelScores).reduce((x,w)=>x+w,0);r.totalScore=n}return ke(r),r},Be=g=>{const s=Ne(g);return s.unlockedHints>0?(s.unlockedHints-=1,ke(s),!0):!1},Ae=g=>{const s=[...g];for(let t=s.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[s[t],s[a]]=[s[a],s[t]]}return s},ie={generatePuzzlePieces:De,checkPiecePlacement:Me,checkPuzzleComplete:Ge,calculateScore:He,getLevels:Ee,getLevel:qe,isLevelUnlocked:Oe,getGameProgress:Ne,saveGameProgress:ke,completeLevel:We,useHint:Be},Re=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState([]),[h,$]=l.useState(null),[u,_]=l.useState(null),[T,I]=l.useState(null),[W,L]=l.useState(null),[M,H]=l.useState(0),[D,P]=l.useState(0),[z,O]=l.useState(0),[R,A]=l.useState(!1),[Q,X]=l.useState(!0),[te,F]=l.useState(!1),J=l.useRef(null);l.useEffect(()=>{if(g){X(!0);try{const o=ie.getLevels();if(w(o),a){const C=ie.getGameProgress(a.id);_(C)}}catch(o){console.error("加载游戏数据失败:",o)}finally{X(!1)}}},[g,a]),l.useEffect(()=>{if(i){const o=ie.generatePuzzlePieces(i);S(o),n("playing"),I(new Date),L(null),H(0),P(0),O(0),A(!1),F(!1)}},[i]),l.useEffect(()=>{let o;return T&&r==="playing"&&(o=setInterval(()=>{const C=Math.round((new Date().getTime()-T.getTime())/1e3);H(C)},1e3)),()=>clearInterval(o)},[T,r]);const Z=l.useCallback(o=>{if(!a){k.error("请先登录！");return}ie.isLevelUnlocked(a.id,o.id)?j(o):k.error("该关卡尚未解锁！")},[a]),c=l.useCallback((o,C)=>{C.isPlaced||$(C)},[]),d=l.useCallback(o=>{$(null)},[]),N=l.useCallback(o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},[]),U=l.useCallback(o=>{if(o.preventDefault(),!h||!J.current)return;const C=parseInt(o.dataTransfer.getData("text/plain")),v=p.find(G=>G.id===C);if(!v||v.isPlaced)return;const Y=J.current.getBoundingClientRect(),ae=(o.clientX-Y.left)/Y.width*100,be=(o.clientY-Y.top)/Y.height*100,oe=ie.checkPiecePlacement(v,ae,be),f=p.map(G=>G.id===v.id?{...G,x:oe?G.correctX:ae,y:oe?G.correctY:be,isPlaced:oe}:G);S(f),P(G=>G+1),ie.checkPuzzleComplete(f)&&ee()},[h,p]),ee=l.useCallback(()=>{if(!a||!i)return;const o=T?Math.round((new Date().getTime()-T.getTime())/1e3):0;L(o);const C=ie.calculateScore(i,o,D,z),v=ie.completeLevel(a.id,i.id,C,o);_(v),n("completed"),k.success(`拼图完成！得分：${C}`)},[a,i,T,D,z]),y=l.useCallback(()=>{if(!(!a||!u||!i))if(ie.useHint(a.id)){A(!0),O(C=>C+1);const o=ie.getGameProgress(a.id);_(o),k.success("已显示提示"),setTimeout(()=>{A(!1)},3e3)}else k.error("提示已用完")},[a,u,i]),B=l.useCallback(()=>{F(o=>!o)},[]),m=l.useCallback(()=>{n("menu"),j(null),S([]),$(null),I(null),L(null),H(0),P(0),O(0),A(!1),F(!1)},[]),E=l.useCallback(()=>{if(!i)return;const o=ie.generatePuzzlePieces(i);S(o),n("playing"),I(new Date),L(null),H(0),P(0),O(0),A(!1),F(!1)},[i]),V=l.useCallback(o=>{if(!o)return"00:00";const C=Math.floor(o/60),v=o%60;return`${C.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},[]);return u!=null&&u.unlockedHints,g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:o=>o.target===o.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化拼图游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[Q&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!Q&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化拼图游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"拼合文化图片，了解天津地方文化和中国传统文化"})]}),u&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:u.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:u.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(o=>{const C=(u==null?void 0:u.completedLevels.includes(o.id))||!1,v=!a||ie.isLevelUnlocked(a.id,o.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${v?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:v?{y:-4}:{},onClick:()=>v&&Z(o),children:[e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:o.imageUrl,alt:o.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),C&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!v&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:o.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:o.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:o.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[o.pieceCount," 片"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:o.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",V(o.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",o.reward]})]})]},o.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&p.length>0&&!Q&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:m,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:B,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-purple-600 hover:bg-purple-700":"bg-purple-500 hover:bg-purple-600"} text-white`,children:[e.jsx("i",{className:"fas fa-eye mr-1"}),te?"隐藏":"显示","答案"]}),e.jsxs("button",{onClick:y,disabled:!u||u.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(u==null?void 0:u.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:V(M)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"移动次数"}),e.jsx("span",{className:"font-medium",children:D})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已完成"}),e.jsxs("span",{className:"font-medium",children:[p.filter(o=>o.isPlaced).length," / ",i.pieceCount]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{ref:J,className:`relative aspect-video rounded-lg overflow-hidden border ${t?"border-gray-700":"border-gray-300"} bg-${t?"gray-800":"gray-100"}`,onDragOver:N,onDrop:U,children:[te&&e.jsx("div",{className:"absolute inset-0 opacity-50 z-0",children:e.jsx(le,{src:i.imageUrl,alt:"Solution",className:"w-full h-full object-cover",ratio:"landscape",fit:"cover",priority:!0})}),e.jsx("div",{className:"absolute inset-0 z-0",children:Array.from({length:i.rows}).map((o,C)=>Array.from({length:i.cols}).map((v,Y)=>{const ae=Y/i.cols*100,be=C/i.rows*100,oe=100/i.cols,f=100/i.rows;return e.jsx("div",{className:`absolute border border-dashed ${t?"border-gray-600":"border-gray-300"} bg-opacity-10`,style:{left:`${ae}%`,top:`${be}%`,width:`${oe}%`,height:`${f}%`}},`slot-${C}-${Y}`)}))}),p.map(o=>e.jsx(b.div,{className:`absolute cursor-move z-20 shadow-md ${o.isPlaced?"z-10 opacity-100":"opacity-80 hover:opacity-100"}`,style:{left:`${o.x}%`,top:`${o.y}%`,width:`${o.width}%`,height:`${o.height}%`,backgroundImage:`url(${o.imageUrl})`,backgroundPosition:`-${o.correctX}% -${o.correctY}%`,backgroundSize:`${i.cols*100}% ${i.rows*100}%`,backgroundRepeat:"no-repeat",border:t?"1px solid #4b5563":"1px solid #e5e7eb",borderRadius:"4px",opacity:o.isPlaced?1:.8},draggable:!o.isPlaced,onDragStart:C=>c(C,o),onDragEnd:d,whileHover:o.isPlaced?{}:{scale:1.05},whileTap:o.isPlaced?{}:{scale:.95},animate:o.isPlaced?{scale:[1,1.1,1],transition:{duration:.3}}:{}},o.id))]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"未放置的碎片"}),e.jsx("div",{className:`p-4 rounded-lg overflow-x-auto ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsx("div",{className:"flex gap-2 min-w-max",children:p.filter(o=>!o.isPlaced).map(o=>e.jsx(b.div,{className:`cursor-move flex-shrink-0 shadow-md ${t?"border-gray-600":"border-gray-300"}`,style:{width:"80px",height:"80px",backgroundImage:`url(${o.imageUrl})`,backgroundPosition:`-${o.correctX}% -${o.correctY}%`,backgroundSize:`${i.cols*100}% ${i.rows*100}%`,backgroundRepeat:"no-repeat",border:"1px solid",borderRadius:"4px"},draggable:!0,onDragStart:C=>c(C,o),onDragEnd:d,whileHover:{scale:1.1},whileTap:{scale:.9}},`piece-${o.id}`))})})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{onClick:E,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新开始"})})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&u&&W!==null&&!Q&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成拼图！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」拼图"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:V(W)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"移动次数"}),e.jsx("p",{className:"text-xl font-bold",children:D})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"提示使用"}),e.jsx("p",{className:"text-xl font-bold",children:z})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:E,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:m,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Ve{constructor(){q(this,"sortItems",[]),q(this,"questions",[]),q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextItemId",1),q(this,"nextQuestionId",1),q(this,"nextLevelId",1),this.initSortItems(),this.initQuestions(),this.initLevels()}initSortItems(){this.sortItems=[{id:`item-${this.nextItemId++}`,name:"天津鼓楼",content:"天津鼓楼",sortValue:1420,description:"天津鼓楼是天津卫的发源地，始建于明永乐十八年（1420年）",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"石家大院",content:"石家大院",sortValue:1875,description:"石家大院是清代津门八大家之一石万程第四子石元士的宅第，始建于1875年",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津劝业场",content:"天津劝业场",sortValue:1928,description:"天津劝业场是天津商业的象征，始建于1928年",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津广播电视塔",content:"天津广播电视塔",sortValue:1991,description:"天津广播电视塔又称天塔，建成于1991年，是天津的标志性建筑之一",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津环球金融中心",content:"天津环球金融中心",sortValue:2010,description:"天津环球金融中心又称津塔，建成于2010年，是天津的摩天大楼",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津周大福金融中心",content:"天津周大福金融中心",sortValue:2019,description:"天津周大福金融中心又称津沽棒，建成于2019年，是天津的新地标",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"春节",content:"春节",sortValue:1,description:"春节是中国最重要的传统节日，农历正月初一",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"元宵节",content:"元宵节",sortValue:15,description:"元宵节又称上元节，农历正月十五",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"清明节",content:"清明节",sortValue:105,description:"清明节是传统祭祖节日，农历三月初五前后",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"端午节",content:"端午节",sortValue:145,description:"端午节又称龙舟节，农历五月初五",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"中秋节",content:"中秋节",sortValue:225,description:"中秋节是传统团圆节日，农历八月十五",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"重阳节",content:"重阳节",sortValue:255,description:"重阳节又称老人节，农历九月初九",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"造纸术",content:"造纸术",sortValue:105,description:"造纸术由东汉蔡伦改进，约公元105年",culturalTheme:"中国传统文化",category:"古代发明"},{id:`item-${this.nextItemId++}`,name:"印刷术",content:"印刷术",sortValue:868,description:"雕版印刷术发明于唐朝，约公元868年",culturalTheme:"中国传统文化",category:"古代发明"},{id:`item-${this.nextItemId++}`,name:"火药",content:"火药",sortValue:904,description:"火药发明于唐朝末年，约公元904年",culturalTheme:"中国传统文化",category:"古代发明"},{id:`item-${this.nextItemId++}`,name:"指南针",content:"指南针",sortValue:1044,description:"指南针发明于北宋，约公元1044年",culturalTheme:"中国传统文化",category:"古代发明"}]}initQuestions(){this.questions=[{id:`question-${this.nextQuestionId++}`,title:"天津地标建筑时间排序",description:"请按照建造时间的先后顺序排列以下天津地标建筑",items:this.sortItems.filter(s=>s.category==="天津建筑"),sortType:"asc",explanation:"天津地标建筑的建造时间顺序反映了天津城市发展的历程，从古代的鼓楼到现代的摩天大楼，见证了天津的繁荣发展。",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`question-${this.nextQuestionId++}`,title:"中国传统节日时间排序",description:"请按照农历时间的先后顺序排列以下中国传统节日",items:this.sortItems.filter(s=>s.category==="传统节日"),sortType:"asc",explanation:"中国传统节日按照农历时间顺序排列，反映了中国传统文化中对自然节律的观察和尊重。",culturalTheme:"中国传统文化",category:"传统节日"},{id:`question-${this.nextQuestionId++}`,title:"中国古代四大发明时间排序",description:"请按照发明时间的先后顺序排列以下中国古代四大发明",items:this.sortItems.filter(s=>s.category==="古代发明"),sortType:"asc",explanation:"中国古代四大发明的出现时间顺序，展示了中国古代科技发展的脉络和成就。",culturalTheme:"中国传统文化",category:"古代发明"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津建筑时间线",description:"了解天津地标建筑的建造时间顺序",questions:[this.questions[0]],gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁天津建筑素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20landmark%20buildings%20skyline"},{id:`level-${this.nextLevelId++}`,name:"中国传统节日",description:"了解中国传统节日的时间顺序",questions:[this.questions[1]],gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统节日素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20festivals%20collection"},{id:`level-${this.nextLevelId++}`,name:"中国古代发明",description:"了解中国古代四大发明的时间顺序",questions:[this.questions[2]],gridSize:{rows:4,cols:4},difficulty:"hard",unlockCondition:{type:"level",value:2},reward:"解锁中国古代发明素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20ancient%20inventions"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getQuestions(){return[...this.questions]}getQuestionById(s){return this.questions.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},unlockedHints:3,bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),a}checkSort(s,t){if(t.length!==s.items.length)return!1;for(let a=0;a<t.length-1;a++){const r=t[a],n=t[a+1];if(s.sortType==="asc"){if(r.sortValue>n.sortValue)return!1}else if(r.sortValue<n.sortValue)return!1}return!0}calculateQuestionScore(s,t,a){let r=0;return t&&(r=100,a&&a<30?r+=20:a&&a<60&&(r+=10)),r}calculateLevelScore(s,t,a,r){const n=s/t,x=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[r]||.5,i=t*60,j=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[r]||1;return Math.round((x+j)*p)}completeLevel(s,t,a,r){const n=this.getGameProgress(s),x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const ge=new Ve,Fe=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState(0),[h,$]=l.useState(null),[u,_]=l.useState([]),[T,I]=l.useState([]),[W,L]=l.useState(!1),[M,H]=l.useState(!1),[D,P]=l.useState(0),[z,O]=l.useState(null),[R,A]=l.useState(null),[Q,X]=l.useState(null),[te,F]=l.useState(!1),[J,Z]=l.useState(!0),[c,d]=l.useState(0),[N,U]=l.useState(0);l.useEffect(()=>{if(g){Z(!0);try{const f=ge.getLevels();if(w(f),a){const G=ge.getGameProgress(a.id);O(G)}}catch(f){console.error("加载游戏数据失败:",f)}finally{Z(!1)}}},[g,a]),l.useEffect(()=>{i&&(S(0),$(i.questions[0]),_(i.questions[0].items),I([]),F(!1),H(!1),P(0),n("playing"),A(new Date),X(null),d(0),U(0),L(!1))},[i]),l.useEffect(()=>{i&&i.questions[p]&&($(i.questions[p]),_(i.questions[p].items),I([]),F(!1),H(!1),L(!1))},[i,p]),l.useEffect(()=>{let f;return R&&r==="playing"&&(f=setInterval(()=>{const G=Math.round((new Date().getTime()-R.getTime())/1e3);d(G)},1e3)),()=>clearInterval(f)},[R,r]),l.useEffect(()=>{i&&r==="playing"&&D>=i.questions.length&&v()},[D,i,r]);const ee=l.useCallback(f=>{if(!a){k.error("请先登录！");return}ge.isLevelUnlocked(a.id,f.id)?j(f):k.error("该关卡尚未解锁！")},[a]),y=l.useCallback((f,G)=>{f.dataTransfer.setData("itemId",G.id)},[]),B=l.useCallback(f=>{f.dataTransfer.clearData("itemId")},[]),m=l.useCallback(f=>{f.preventDefault()},[]),E=l.useCallback(f=>{f.preventDefault()},[]),V=l.useCallback((f,G)=>{f.preventDefault();const se=f.dataTransfer.getData("itemId");if(!se)return;const we=u.find(de=>de.id===se);we&&(G!==void 0?(_(de=>de.filter(fe=>fe.id!==se)),I(de=>{const fe=[...de];return fe.splice(G,0,we),fe})):(I(de=>de.filter(fe=>fe.id!==se)),_(de=>[...de,we])))},[u]),o=l.useCallback(f=>{u.includes(f)?(_(G=>G.filter(se=>se.id!==f.id)),I(G=>[...G,f])):(I(G=>G.filter(se=>se.id!==f.id)),_(G=>[...G,f]))},[u]),C=l.useCallback(()=>{if(!h||T.length!==h.items.length){k.error("请将所有项排序完成！");return}L(!0);const f=ge.checkSort(h,T);H(f),f?(P(G=>G+1),k.success("排序正确！"),setTimeout(()=>{p<((i==null?void 0:i.questions.length)||0)-1?S(G=>G+1):v(),L(!1)},1500)):(k.error("排序错误，请重新尝试！"),L(!1))},[h,T,p,i]),v=l.useCallback(()=>{if(!a||!i)return;const f=R?Math.round((new Date().getTime()-R.getTime())/1e3):0;X(f);const G=ge.calculateLevelScore(D,i.questions.length,f,i.difficulty),se=ge.completeLevel(a.id,i.id,G,f);O(se),n("completed"),k.success(`关卡完成！得分：${G}`)},[a,i,D,R]),Y=l.useCallback(()=>{if(!(!a||!z||!h))if(ge.useHint(a.id)){F(!0),U(G=>G+1);const f=ge.getGameProgress(a.id);O(f),k.success("已显示提示")}else k.error("提示已用完")},[a,z,h]),ae=l.useCallback(()=>{n("menu"),j(null),$(null),S(0),_([]),I([]),H(!1),P(0),A(null),X(null),F(!1),L(!1),d(0),U(0)},[]),be=l.useCallback(()=>{i&&(S(0),$(i.questions[0]),_(i.questions[0].items),I([]),F(!1),H(!1),P(0),n("playing"),A(new Date),X(null),d(0),U(0),L(!1))},[i]),oe=l.useCallback(f=>{const G=Math.floor(f/60),se=f%60;return`${G.toString().padStart(2,"0")}:${se.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:f=>f.target===f.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化元素排序游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[J&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!J&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化元素排序游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"按照时间顺序或逻辑顺序排列文化元素，了解天津地方文化和中国传统文化"})]}),z&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:z.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:z.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:z.unlockedHints})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(f=>{const G=(z==null?void 0:z.completedLevels.includes(f.id))||!1,se=!a||ge.isLevelUnlocked(a.id,f.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${se?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:se?{y:-4}:{},onClick:()=>se&&ee(f),children:[f.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:f.imageUrl,alt:f.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),G&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!se&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:f.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:f.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:f.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[f.questions.length," 题"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:f.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[f.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",oe(f.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",f.reward]})]})]},f.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&h&&!J&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 md:mb-0",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:oe(c)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"进度"}),e.jsxs("span",{className:"font-medium",children:[p+1," / ",i.questions.length]})]}),e.jsx("button",{onClick:ae,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:Y,disabled:!z||z.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(z==null?void 0:z.unlockedHints)||0,")"]})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"text-lg font-medium mb-2",children:h.title}),e.jsx("p",{className:`mb-4 ${t?"text-gray-300":"text-gray-700"}`,children:h.description}),te&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mt-1 mr-2"}),e.jsxs("p",{className:`text-sm ${t?"text-yellow-200":"text-yellow-800"}`,children:["提示：请按照",h.sortType==="asc"?"升序":"降序","排列"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-md font-medium mb-3",children:"待排序项"}),e.jsx("div",{className:`min-h-[200px] p-4 rounded-lg border-2 border-dashed ${t?"border-gray-600 bg-gray-800":"border-gray-300 bg-gray-50"} transition-all hover:border-blue-500`,onDragOver:E,onDragEnter:m,onDrop:f=>V(f),children:u.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-500":"text-gray-400"}`,children:"所有项已排序"}):e.jsx("div",{className:"space-y-3",children:u.map(f=>e.jsxs("div",{className:`p-3 rounded-lg cursor-move transition-all ${t?"bg-gray-700 hover:bg-gray-600":"bg-white hover:bg-gray-50"} border ${t?"border-gray-600":"border-gray-200"} hover:shadow-md`,draggable:!0,onClick:()=>o(f),onDragStart:G=>y(G,f),onDragEnd:B,children:[e.jsx("h6",{className:"font-medium",children:f.name}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-gray-400":"text-gray-500"}`,children:f.content})]},f.id))})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-md font-medium mb-3",children:"已排序项"}),e.jsx("div",{className:`min-h-[200px] p-4 rounded-lg border-2 border-dashed ${t?"border-gray-600 bg-gray-800":"border-gray-300 bg-gray-50"} transition-all hover:border-blue-500`,children:T.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-500":"text-gray-400"}`,children:"拖拽或点击项到此处进行排序"}):e.jsx("div",{className:"space-y-3",children:T.map((f,G)=>e.jsx("div",{className:`p-3 rounded-lg cursor-move transition-all ${t?"bg-gray-700 hover:bg-gray-600":"bg-white hover:bg-gray-50"} border ${t?"border-gray-600":"border-gray-200"} hover:shadow-md`,draggable:!0,onDragStart:se=>y(se,f),onDragEnd:B,onDragOver:E,onDragEnter:m,onDrop:se=>V(se,G),onClick:()=>o(f),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium",children:f.name}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-gray-400":"text-gray-500"}`,children:f.content})]}),e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-gray-600":"bg-gray-200"}`,children:G+1})]})},f.id))})})]})]}),W&&M&&e.jsx("div",{className:`p-3 rounded-lg ${t?"bg-green-900 bg-opacity-30":"bg-green-100"} border ${t?"border-green-700":"border-green-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mt-1 mr-2"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-1",children:"回答正确！"}),e.jsx("p",{className:`text-sm ${t?"text-green-200":"text-green-800"}`,children:h.explanation})]})]})}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{onClick:C,disabled:W||T.length!==h.items.length,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:W?"检查中...":"提交排序"})})]})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&z&&!J&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:z.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:oe(Q||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总题数"}),e.jsx("p",{className:"text-xl font-bold",children:i.questions.length})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsx("button",{onClick:be,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:ae,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Qe{constructor(){q(this,"riddles",[]),q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextRiddleId",1),q(this,"nextLevelId",1),this.initRiddles(),this.initLevels()}initRiddles(){this.riddles=[{id:`riddle-${this.nextRiddleId++}`,title:"天津特产",content:"形如元宝，皮薄馅大，咬一口汤汁四溢，天津名吃人人夸。",hints:["这是天津的传统名吃","它的名字和狗有关","它是一种包子"],answer:"狗不理包子",explanation:'狗不理包子是天津的传统名吃，因其创始人高贵友乳名"狗子"而得名，以皮薄馅大、汤汁鲜美著称。',culturalTheme:"天津地方文化",category:"天津美食",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"天津地标",content:"一座铁桥横跨海河，百年历史见证天津变迁。",hints:["这是天津的标志性桥梁","它的名字与一个国家有关","它建于1907年"],answer:"解放桥",explanation:"解放桥原名万国桥，是天津的标志性桥梁，横跨海河，建于1907年，见证了天津的百年变迁。",culturalTheme:"天津地方文化",category:"天津建筑",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"天津民俗",content:"正月十五闹花灯，天津特色民俗活动。",hints:["这是天津的传统民俗活动","它在元宵节举行","活动地点在天津的一个著名古文化街"],answer:"杨柳青灯会",explanation:"杨柳青灯会是天津的传统民俗活动，每年元宵节在杨柳青古镇举行，展示精美的花灯和传统文化。",culturalTheme:"天津地方文化",category:"天津民俗",difficulty:"medium"},{id:`riddle-${this.nextRiddleId++}`,title:"传统节日",content:"嫦娥奔月的故事与之相关，家家户户吃月饼。",hints:["这是中国的传统节日","它在农历八月十五","与月亮有关"],answer:"中秋节",explanation:"中秋节是中国的传统节日，每年农历八月十五，人们会赏月、吃月饼，嫦娥奔月是与中秋节相关的传说故事。",culturalTheme:"中国传统文化",category:"传统节日",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"传统艺术",content:"一支毛笔，一张宣纸，挥洒自如，中国特色绘画。",hints:["这是中国的传统绘画形式","使用水墨作为主要颜料","强调意境和神韵"],answer:"国画",explanation:"国画是中国的传统绘画形式，使用毛笔、宣纸和水墨等工具，强调意境和神韵，是中国传统文化的重要组成部分。",culturalTheme:"中国传统文化",category:"传统艺术",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"历史人物",content:'儒家学派创始人，主张"仁"和"礼"。',hints:["他是中国古代思想家","他的弟子记录了他的言行",'他被尊称为"圣人"'],answer:"孔子",explanation:'孔子是儒家学派的创始人，主张"仁"和"礼"，是中国古代伟大的思想家、教育家，被尊称为"圣人"。',culturalTheme:"中国传统文化",category:"历史人物",difficulty:"medium"},{id:`riddle-${this.nextRiddleId++}`,title:"传统工艺",content:"以泥为原料，塑造栩栩如生的人物形象。",hints:["这是中国的传统民间工艺",'天津有著名的"泥人张"',"使用泥土作为主要材料"],answer:"泥人",explanation:'泥人是中国的传统民间工艺，以泥土为原料，塑造栩栩如生的人物形象，天津的"泥人张"是其中的代表。',culturalTheme:"中国传统文化",category:"传统工艺",difficulty:"medium"},{id:`riddle-${this.nextRiddleId++}`,title:"传统节日",content:"屈原投江的故事与之相关，人们赛龙舟、吃粽子。",hints:["这是中国的传统节日","它在农历五月初五","与一位爱国诗人有关"],answer:"端午节",explanation:"端午节是中国的传统节日，每年农历五月初五，人们会赛龙舟、吃粽子，以纪念爱国诗人屈原。",culturalTheme:"中国传统文化",category:"传统节日",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"天津历史",content:'天津古代的名称，意为"天子经过的渡口"。',hints:["这是天津的古称","与明朝皇帝朱棣有关","意为天子经过的渡口"],answer:"天津卫",explanation:'天津卫是天津的古称，意为"天子经过的渡口"，明朝永乐二年（1404年），朱棣为纪念自己在此渡过大运河南下争夺皇位，赐名"天津"。',culturalTheme:"天津地方文化",category:"天津历史",difficulty:"hard"},{id:`riddle-${this.nextRiddleId++}`,title:"传统哲学",content:"老子的代表作，蕴含深刻的道家思想。",hints:["这是中国古代哲学著作","作者是老子","全书共81章"],answer:"道德经",explanation:"《道德经》是老子的代表作，蕴含深刻的道家思想，全书共81章，是中国古代哲学的重要经典。",culturalTheme:"中国传统文化",category:"传统哲学",difficulty:"hard"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化入门",description:"了解天津的基本文化常识",riddles:this.riddles.filter(s=>s.culturalTheme==="天津地方文化"&&s.difficulty==="easy"),gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁天津文化素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20heritage"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化基础",description:"了解中国传统文化的基本常识",riddles:this.riddles.filter(s=>s.culturalTheme==="中国传统文化"&&s.difficulty==="easy"),gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁中国传统文化素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20culture%20collection"},{id:`level-${this.nextLevelId++}`,name:"天津文化进阶",description:"深入了解天津的文化底蕴",riddles:this.riddles.filter(s=>s.culturalTheme==="天津地方文化"&&s.difficulty==="medium"),gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁天津文化高级素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20traditional%20culture"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化进阶",description:"深入了解中国传统文化的丰富内涵",riddles:this.riddles.filter(s=>s.culturalTheme==="中国传统文化"&&s.difficulty==="medium"),gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:2},reward:"解锁中国传统文化高级素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20art"},{id:`level-${this.nextLevelId++}`,name:"文化知识挑战",description:"综合挑战天津文化和中国传统文化知识",riddles:this.riddles.filter(s=>s.difficulty==="hard"),gridSize:{rows:4,cols:4},difficulty:"hard",unlockCondition:{type:"level",value:4},reward:"解锁高级文化素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20knowledge%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getRiddles(){return[...this.riddles]}getRiddleById(s){return this.riddles.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},unlockedHints:3,bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),a}checkAnswer(s,t){const a=t.trim().toLowerCase(),r=s.answer.trim().toLowerCase();return a===r}calculateRiddleScore(s,t,a,r){const n={easy:50,medium:100,hard:150}[s.difficulty];let x=0;return t&&(x=n,a&&a<10?x+=20:a&&a<30&&(x+=10),r&&(x=Math.max(0,x-r*10))),x}calculateLevelScore(s,t,a,r,n){const x=s/t,w=Math.round(100*x),i={easy:.3,medium:.5,hard:.8}[r]||.5,j=t*60,p=Math.max(0,j-a)*i,S={easy:1,medium:1.2,hard:1.5}[r]||1,h=n*5;return Math.round((w+p-h)*S)}completeLevel(s,t,a,r){const n=this.getGameProgress(s),x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const re=new Qe,Ye=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState(0),[h,$]=l.useState(null),[u,_]=l.useState(""),[T,I]=l.useState(!1),[W,L]=l.useState(!1),[M,H]=l.useState(0),[D,P]=l.useState(null),[z,O]=l.useState(null),[R,A]=l.useState(null),[Q,X]=l.useState(0),[te,F]=l.useState(!1),[J,Z]=l.useState(!0),[c,d]=l.useState(0),[N,U]=l.useState(0);l.useEffect(()=>{if(g){Z(!0);try{const v=re.getLevels();if(w(v),a){const Y=re.getGameProgress(a.id);P(Y)}}catch(v){console.error("加载游戏数据失败:",v)}finally{Z(!1)}}},[g,a]),l.useEffect(()=>{i&&(S(0),$(i.riddles[0]),_(""),I(!1),L(!1),H(0),n("playing"),O(new Date),A(null),X(0),F(!1),d(0),U(0))},[i]),l.useEffect(()=>{i&&i.riddles[p]&&($(i.riddles[p]),_(""),I(!1),L(!1),X(0),F(!1))},[i,p]),l.useEffect(()=>{let v;return z&&r==="playing"&&(v=setInterval(()=>{const Y=Math.round((new Date().getTime()-z.getTime())/1e3);d(Y)},1e3)),()=>clearInterval(v)},[z,r]),l.useEffect(()=>{i&&r==="playing"&&M>=i.riddles.length&&B()},[M,i,r]);const ee=l.useCallback(v=>{if(!a){k.error("请先登录！");return}re.isLevelUnlocked(a.id,v.id)?j(v):k.error("该关卡尚未解锁！")},[a]),y=l.useCallback(()=>{if(!h||u.trim()===""){k.error("请输入答案！");return}I(!0);const v=re.checkAnswer(h,u);L(v),v?(H(Y=>Y+1),k.success("回答正确！"),setTimeout(()=>{p<((i==null?void 0:i.riddles.length)||0)-1?S(Y=>Y+1):B(),I(!1)},1500)):(k.error("回答错误，请重新尝试！"),I(!1))},[h,u,p,i]),B=l.useCallback(()=>{if(!a||!i)return;const v=z?Math.round((new Date().getTime()-z.getTime())/1e3):0;A(v);const Y=re.calculateLevelScore(M,i.riddles.length,v,i.difficulty,N),ae=re.completeLevel(a.id,i.id,Y,v);P(ae),n("completed"),k.success(`关卡完成！得分：${Y}`)},[a,i,M,z,N]),m=l.useCallback(()=>{if(!(!a||!D||!h)){if(Q>=h.hints.length){k.error("提示已用完");return}if(re.useHint(a.id)){F(!0),U(Y=>Y+1);const v=re.getGameProgress(a.id);P(v),k.success("已显示提示")}else k.error("提示已用完")}},[a,D,h,Q]),E=l.useCallback(()=>{if(!(!a||!h||Q>=h.hints.length-1))if(re.useHint(a.id)){X(Y=>Y+1),U(Y=>Y+1);const v=re.getGameProgress(a.id);P(v),k.success("已显示下一个提示")}else k.error("提示已用完")},[a,h,Q]),V=l.useCallback(()=>{n("menu"),j(null),$(null),S(0),_(""),L(!1),H(0),O(null),A(null),X(0),F(!1),I(!1),d(0),U(0)},[]),o=l.useCallback(()=>{i&&(S(0),$(i.riddles[0]),_(""),L(!1),H(0),n("playing"),O(new Date),A(null),X(0),F(!1),d(0),U(0),I(!1))},[i]),C=l.useCallback(v=>{const Y=Math.floor(v/60),ae=v%60;return`${Y.toString().padStart(2,"0")}:${ae.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:v=>v.target===v.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-2xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化猜谜游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[J&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!J&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化猜谜游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"根据提示猜文化元素、成语或历史人物，了解天津地方文化和中国传统文化"})]}),D&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:D.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:D.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:D.unlockedHints})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(v=>{const Y=(D==null?void 0:D.completedLevels.includes(v.id))||!1,ae=!a||re.isLevelUnlocked(a.id,v.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${ae?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:ae?{y:-4}:{},onClick:()=>ae&&ee(v),children:[v.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:v.imageUrl,alt:v.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),Y&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!ae&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:v.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:v.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:v.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[v.riddles.length," 题"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:v.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[v.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",C(v.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",v.reward]})]})]},v.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&h&&!J&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 md:mb-0",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:C(c)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"进度"}),e.jsxs("span",{className:"font-medium",children:[p+1," / ",i.riddles.length]})]}),e.jsx("button",{onClick:V,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("h4",{className:"text-lg font-medium mb-2",children:["第 ",p+1," 题：",h.title]}),e.jsx("p",{className:`mb-6 text-lg ${t?"text-gray-300":"text-gray-700"}`,children:h.content}),te&&h.hints[Q]&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mr-2"}),e.jsxs("span",{className:`font-medium ${t?"text-yellow-200":"text-yellow-800"}`,children:["提示 ",Q+1,"/",h.hints.length]})]}),e.jsx("p",{className:`text-sm ${t?"text-yellow-200":"text-yellow-800"} mb-2`,children:h.hints[Q]}),Q<h.hints.length-1&&e.jsx("button",{onClick:E,className:`text-xs self-start px-2 py-1 rounded-lg ${t?"bg-yellow-800 hover:bg-yellow-700 text-yellow-200":"bg-yellow-200 hover:bg-yellow-300 text-yellow-800"}`,children:"获取下一个提示"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"请输入答案...",value:u,onChange:v=>_(v.target.value),onKeyPress:v=>v.key==="Enter"&&y(),className:`flex-1 px-4 py-3 rounded-lg ${t?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"} border focus:outline-none focus:ring-2 focus:ring-blue-500`,disabled:T}),e.jsx("button",{onClick:y,disabled:T||u.trim()==="",className:`px-4 py-3 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:T?"检查中...":"提交"})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs("button",{onClick:m,disabled:te&&Q>=h.hints.length-1,className:`text-sm px-3 py-1 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"获取提示 (",(D==null?void 0:D.unlockedHints)||0,")"]})})]}),T&&W&&e.jsx("div",{className:`p-3 rounded-lg ${t?"bg-green-900 bg-opacity-30":"bg-green-100"} border ${t?"border-green-700":"border-green-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mt-1 mr-2"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-1",children:"回答正确！"}),e.jsx("p",{className:`text-sm ${t?"text-green-200":"text-green-800"}`,children:h.explanation})]})]})})]})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&D&&!J&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:D.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:C(R||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsxs("p",{className:"text-xl font-bold",children:[Math.round(M/i.riddles.length*100),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总题数"}),e.jsx("p",{className:"text-xl font-bold",children:i.riddles.length})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsx("button",{onClick:o,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:V,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Je{constructor(){q(this,"words",[]),q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextWordId",1),q(this,"nextLevelId",1),this.initWords(),this.initLevels()}initWords(){this.words=[{id:`word-${this.nextWordId++}`,word:"天津",pinyin:"tiān jīn",meaning:"中国四大直辖市之一，位于华北平原东北部",culturalTheme:"天津地方文化",category:"地理"},{id:`word-${this.nextWordId++}`,word:"津门",pinyin:"jīn mén",meaning:"天津的别称",culturalTheme:"天津地方文化",category:"地理"},{id:`word-${this.nextWordId++}`,word:"门脸",pinyin:"mén liǎn",meaning:"天津方言，指店铺的门面",culturalTheme:"天津地方文化",category:"方言"},{id:`word-${this.nextWordId++}`,word:"脸谱",pinyin:"liǎn pǔ",meaning:"戏曲演员面部化妆的谱式",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"谱曲",pinyin:"pǔ qǔ",meaning:"为歌词配上曲子",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"曲艺",pinyin:"qǔ yì",meaning:"中国传统的说唱艺术",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"艺术",pinyin:"yì shù",meaning:"用形象来反映现实但比现实有典型性的社会意识形态",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"术语",pinyin:"shù yǔ",meaning:"各门学科中用以表示严格规定的意义的专门用语",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"语文",pinyin:"yǔ wén",meaning:"语言和文学的简称",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"文学",pinyin:"wén xué",meaning:"以语言文字为工具形象化地反映客观现实的艺术",culturalTheme:"中国传统文化",category:"传统文学"},{id:`word-${this.nextWordId++}`,word:"学问",pinyin:"xué wèn",meaning:"系统的知识",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"问题",pinyin:"wèn tí",meaning:"要求回答或解释的题目",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"题材",pinyin:"tí cái",meaning:"构成文学和艺术作品的材料",culturalTheme:"中国传统文化",category:"传统文学"},{id:`word-${this.nextWordId++}`,word:"才子",pinyin:"cái zǐ",meaning:"指有才华的男子",culturalTheme:"中国传统文化",category:"历史人物"},{id:`word-${this.nextWordId++}`,word:"子孙",pinyin:"zǐ sūn",meaning:"儿子和孙子，泛指后代",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"孙女",pinyin:"sūn nǚ",meaning:"儿子的女儿",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"女儿",pinyin:"nǚ ér",meaning:"女孩子",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"儿歌",pinyin:"ér gē",meaning:"为儿童创作的歌曲",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"歌唱",pinyin:"gē chàng",meaning:"用唱歌、朗诵等形式颂扬",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"唱戏",pinyin:"chàng xì",meaning:"表演戏曲",culturalTheme:"中国传统文化",category:"传统艺术"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"文化入门接龙",description:"了解基本的文化词汇，进行简单的接龙游戏",words:this.words.slice(0,10),difficulty:"easy",reward:"解锁文化词汇素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20word%20chain%20game"},{id:`level-${this.nextLevelId++}`,name:"天津文化接龙",description:"学习天津文化相关词汇，进行接龙游戏",words:this.words.slice(0,5).concat(this.words.slice(15,20)),difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁天津文化词汇素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20word%20chain%20game"},{id:`level-${this.nextLevelId++}`,name:"文化词汇挑战",description:"挑战更复杂的文化词汇接龙",words:this.words,difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁高级文化词汇素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20word%20chain%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getWords(){return[...this.words]}getWordById(s){return this.words.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),a}checkWordChain(s,t){return!s||!t?!1:s.slice(-1)===t.slice(0,1)}isWordInLevel(s,t){return t.words.some(a=>a.word===s)}calculateLevelScore(s,t,a){const r=s*10,n={easy:.3,medium:.5,hard:.8}[a]||.5,x=s*20,w=Math.max(0,x-t)*n,i={easy:1,medium:1.2,hard:1.5}[a]||1;return Math.round((r+w)*i)}completeLevel(s,t,a,r){const n=this.getGameProgress(s),x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const ne=new Je,Xe=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState([]),[h,$]=l.useState(""),[u,_]=l.useState(""),[T,I]=l.useState(!1),[W,L]=l.useState(""),[M,H]=l.useState(null),[D,P]=l.useState(null),[z,O]=l.useState(null),[R,A]=l.useState(!0),[Q,X]=l.useState(0);l.useEffect(()=>{if(g){A(!0);try{const y=ne.getLevels();if(w(y),a){const B=ne.getGameProgress(a.id);H(B)}}catch(y){console.error("加载游戏数据失败:",y)}finally{A(!1)}}},[g,a]),l.useEffect(()=>{if(i){const y=i.words[Math.floor(Math.random()*i.words.length)].word;S([y]),_(y),$(""),I(!1),L(""),n("playing"),P(new Date),O(null),X(0)}},[i]),l.useEffect(()=>{let y;return D&&r==="playing"&&(y=setInterval(()=>{const B=Math.round((new Date().getTime()-D.getTime())/1e3);X(B)},1e3)),()=>clearInterval(y)},[D,r]);const te=l.useCallback(y=>{if(!a){k.error("请先登录！");return}ne.isLevelUnlocked(a.id,y.id)?j(y):k.error("该关卡尚未解锁！")},[a]),F=l.useCallback(y=>{$(y.target.value)},[]),J=l.useCallback(()=>{if(!i||!h.trim()||!u)return;const y=h.trim();if(!ne.isWordInLevel(y,i)){k.error("该词汇不在关卡词汇列表中！");return}if(!ne.checkWordChain(u,y)){k.error("词汇接龙无效，请确保前一个词的最后一个字作为下一个词的第一个字！");return}if(p.includes(y)){k.error("该词汇已经使用过，请换一个！");return}const B=[...p,y];S(B),_(y),$(""),I(!1),L(""),B.length>=i.words.length/2&&d(),k.success("词汇接龙成功！")},[i,h,u,p]),Z=l.useCallback(y=>{y.key==="Enter"&&J()},[J]),c=l.useCallback(()=>{if(!(!a||!M||!i||!u))if(ne.useHint(a.id)){const y=i.words.filter(m=>!p.includes(m.word)).filter(m=>m.word.startsWith(u.slice(-1)));if(y.length>0){const m=y[Math.floor(Math.random()*y.length)].word;L(m),I(!0)}const B=ne.getGameProgress(a.id);H(B),k.success("已显示提示")}else k.error("提示已用完")},[a,M,i,u,p]),d=l.useCallback(()=>{if(!a||!i)return;const y=D?Math.round((new Date().getTime()-D.getTime())/1e3):0;O(y);const B=ne.calculateLevelScore(p.length,y,i.difficulty),m=ne.completeLevel(a.id,i.id,B,y);H(m),n("completed"),k.success(`关卡完成！得分：${B}`)},[a,i,p,D]),N=l.useCallback(()=>{n("menu"),j(null),S([]),_(""),$(""),I(!1),L(""),P(null),O(null),X(0)},[]),U=l.useCallback(()=>{if(!i)return;const y=i.words[Math.floor(Math.random()*i.words.length)].word;S([y]),_(y),$(""),I(!1),L(""),n("playing"),P(new Date),O(null),X(0)},[i]),ee=l.useCallback(y=>{if(!y)return"00:00";const B=Math.floor(y/60),m=y%60;return`${B.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:y=>y.target===y.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-2xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化词汇接龙"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[R&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!R&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化词汇接龙"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"根据文化主题进行词汇接龙，前一个词的最后一个字作为下一个词的第一个字"})]}),M&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:M.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:M.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:M.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(y=>{const B=(M==null?void 0:M.completedLevels.includes(y.id))||!1,m=!a||ne.isLevelUnlocked(a.id,y.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${m?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:m?{y:-4}:{},onClick:()=>m&&te(y),children:[y.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:y.imageUrl,alt:y.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),B&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!m&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:y.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:y.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:y.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[y.words.length," 词汇"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:y.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[y.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",ee(y.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",y.reward]})]})]},y.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&!R&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:N,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:c,disabled:!M||M.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(M==null?void 0:M.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"接龙长度"}),e.jsx("span",{className:"font-medium",children:p.length})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:ee(Q)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余词汇"}),e.jsx("span",{className:"font-medium",children:i.words.length-p.length})]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"text-lg font-medium mb-3",children:"词汇链"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:p.map((y,B)=>e.jsx(b.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3,delay:B*.1},className:`px-3 py-2 rounded-full ${t?"bg-blue-600":"bg-blue-500"} text-white text-sm font-medium`,children:y},B))}),T&&W&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mt-1 mr-2"}),e.jsxs("p",{className:`text-sm ${t?"text-yellow-200":"text-yellow-800"}`,children:["提示：可以接「",W,"」"]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:F,onKeyPress:Z,placeholder:`请输入以「${u.slice(-1)}」开头的词汇`,className:`flex-grow p-3 rounded-lg ${t?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"} border focus:outline-none focus:ring-2 focus:ring-blue-500`,disabled:!u}),e.jsx("button",{onClick:J,disabled:!h.trim(),className:`px-4 py-3 rounded-lg transition-colors ${t?"bg-green-600 hover:bg-green-700":"bg-green-500 hover:bg-green-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:"提交"})]})]})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&M&&!R&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:M.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:ee(z||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"接龙长度"}),e.jsx("p",{className:"text-xl font-bold",children:p.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:U,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:N,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Ke{constructor(){q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextLevelId",1),q(this,"nextDifferenceId",1),this.initLevels()}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津古文化街",description:"找出两张天津古文化街图片的不同之处",originalImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20ancient%20culture%20street%20with%20traditional%20Chinese%20architecture",modifiedImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20ancient%20culture%20street%20with%20traditional%20Chinese%20architecture%20and%20a%20red%20lantern%20missing",differences:[{id:`diff-${this.nextDifferenceId++}`,position:{x:25,y:30,width:10,height:15},description:"缺少了一个红色灯笼",hint:"在左侧建筑的屋檐下"},{id:`diff-${this.nextDifferenceId++}`,position:{x:75,y:45,width:8,height:12},description:"人物穿着不同",hint:"在右侧街道上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:45,y:60,width:12,height:10},description:"店铺招牌文字不同",hint:"在中间店铺的招牌上"}],difficulty:"easy",reward:"解锁天津古文化街素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20ancient%20culture%20street%20spot%20the%20difference%20game"},{id:`level-${this.nextLevelId++}`,name:"中国传统建筑",description:"找出两张中国传统建筑图片的不同之处",originalImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Traditional%20Chinese%20architecture%20with%20a%20temple",modifiedImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Traditional%20Chinese%20architecture%20with%20a%20temple%20and%20different%20roof%20design",differences:[{id:`diff-${this.nextDifferenceId++}`,position:{x:45,y:20,width:15,height:15},description:"屋顶设计不同",hint:"在寺庙的屋顶上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:30,y:50,width:10,height:12},description:"缺少了一个石狮子",hint:"在寺庙的入口处"},{id:`diff-${this.nextDifferenceId++}`,position:{x:65,y:35,width:8,height:10},description:"窗户设计不同",hint:"在右侧建筑的墙上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:75,y:60,width:12,height:15},description:"树木数量不同",hint:"在右侧背景中"}],difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统建筑素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20architecture%20spot%20the%20difference%20game"},{id:`level-${this.nextLevelId++}`,name:"天津民俗文化",description:"找出两张天津民俗文化图片的不同之处",originalImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20folk%20culture%20performance",modifiedImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20folk%20culture%20performance%20with%20different%20costumes%20and%20props",differences:[{id:`diff-${this.nextDifferenceId++}`,position:{x:20,y:40,width:12,height:18},description:"表演者服装不同",hint:"在左侧表演者身上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:50,y:55,width:10,height:15},description:"道具不同",hint:"在中间表演者手中"},{id:`diff-${this.nextDifferenceId++}`,position:{x:70,y:30,width:15,height:12},description:"背景装饰不同",hint:"在右侧背景中"},{id:`diff-${this.nextDifferenceId++}`,position:{x:35,y:25,width:8,height:10},description:"头饰不同",hint:"在左侧表演者头上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:60,y:65,width:12,height:10},description:"地面图案不同",hint:"在右侧地面上"}],difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁天津民俗文化素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20folk%20culture%20spot%20the%20difference%20game"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),a}isDifferenceFound(s,t,a=5){const{x:r,y:n}=t.position,{x,y:w}=s;return Math.sqrt(Math.pow(x-r,2)+Math.pow(w-n,2))<=a}calculateLevelScore(s,t,a,r){const n=s/t,x=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[r]||.5,i=t*30,j=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[r]||1;return Math.round((x+j)*p)}completeLevel(s,t,a,r){const n=this.getGameProgress(s),x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const xe=new Ke,Ze=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState(new Set),[h,$]=l.useState(null),[u,_]=l.useState(null),[T,I]=l.useState(null),[W,L]=l.useState(!0),[M,H]=l.useState(0),[D,P]=l.useState(!1),[z,O]=l.useState(null),R=l.useRef(null);l.useEffect(()=>{if(g){L(!0);try{const c=xe.getLevels();if(w(c),a){const d=xe.getGameProgress(a.id);$(d)}}catch(c){console.error("加载游戏数据失败:",c)}finally{L(!1)}}},[g,a]),l.useEffect(()=>{i&&(S(new Set),P(!1),O(null),n("playing"),_(new Date),I(null),H(0))},[i]),l.useEffect(()=>{let c;return u&&r==="playing"&&(c=setInterval(()=>{const d=Math.round((new Date().getTime()-u.getTime())/1e3);H(d)},1e3)),()=>clearInterval(c)},[u,r]);const A=l.useCallback(c=>{if(!a){k.error("请先登录！");return}xe.isLevelUnlocked(a.id,c.id)?j(c):k.error("该关卡尚未解锁！")},[a]),Q=l.useCallback(c=>{var d;if(!i||r!=="playing")return;const N=c.currentTarget.getBoundingClientRect();if(!((d=R.current)!=null&&d.getBoundingClientRect()))return;const U=(c.clientX-N.left)/N.width*100,ee=(c.clientY-N.top)/N.height*100;for(const y of i.differences)if(!p.has(y.id)&&xe.isDifferenceFound({x:U,y:ee},y)){S(B=>{const m=new Set(B);return m.add(y.id),m}),k.success(`找到差异点：${y.description}`),p.size+1===i.differences.length&&te();break}},[i,r,p]),X=l.useCallback(()=>{if(!(!a||!h||!i))if(xe.useHint(a.id)){const c=i.differences.filter(N=>!p.has(N.id));c.length>0&&(O(c[0]),P(!0),setTimeout(()=>{P(!1),O(null)},3e3));const d=xe.getGameProgress(a.id);$(d),k.success("已显示提示，请注意观察提示区域")}else k.error("提示已用完")},[a,h,i,p]),te=l.useCallback(()=>{if(!a||!i)return;const c=u?Math.round((new Date().getTime()-u.getTime())/1e3):0;I(c);const d=xe.calculateLevelScore(p.size,i.differences.length,c,i.difficulty),N=xe.completeLevel(a.id,i.id,d,c);$(N),n("completed"),k.success(`关卡完成！得分：${d}`)},[a,i,p,u]),F=l.useCallback(()=>{n("menu"),j(null),S(new Set),_(null),I(null),H(0),P(!1),O(null)},[]),J=l.useCallback(()=>{i&&(S(new Set),P(!1),O(null),n("playing"),_(new Date),I(null),H(0))},[i]),Z=l.useCallback(c=>{if(!c)return"00:00";const d=Math.floor(c/60),N=c%60;return`${d.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:c=>c.target===c.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化图片找茬"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[W&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!W&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化图片找茬"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"找出两张文化图片的不同之处，了解更多天津地方文化和中国传统文化"})]}),h&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:h.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:h.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:h.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(c=>{const d=(h==null?void 0:h.completedLevels.includes(c.id))||!1,N=!a||xe.isLevelUnlocked(a.id,c.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${N?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:N?{y:-4}:{},onClick:()=>N&&A(c),children:[c.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),d&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!N&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:c.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:c.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:c.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[c.differences.length," 处差异"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:c.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[c.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",Z(c.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",c.reward]})]})]},c.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&!W&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:F,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:X,disabled:!h||h.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(h==null?void 0:h.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已找到差异"}),e.jsxs("span",{className:"font-medium",children:[p.size," / ",i.differences.length]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:Z(M)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余差异"}),e.jsx("span",{className:"font-medium",children:i.differences.length-p.size})]})]})]}),e.jsxs("div",{ref:R,className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("h4",{className:"text-center font-medium mb-2",children:"原始图片"}),e.jsxs("div",{className:`relative overflow-hidden rounded-lg border ${t?"border-gray-700":"border-gray-200"}`,children:[e.jsx(le,{src:i.originalImageUrl,alt:"原始图片",className:"w-full h-auto cursor-pointer transition-transform hover:scale-105",onClick:Q,priority:!0,fit:"contain"}),i.differences.map(c=>p.has(c.id)?e.jsx(b.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"absolute border-2 border-green-500 bg-green-500 bg-opacity-20 rounded-lg",style:{left:`${c.position.x-c.position.width/2}%`,top:`${c.position.y-c.position.height/2}%`,width:`${c.position.width}%`,height:`${c.position.height}%`},children:e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.jsx("i",{className:"fas fa-check"})})},c.id):null)]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("h4",{className:"text-center font-medium mb-2",children:"修改后的图片"}),e.jsxs("div",{className:`relative overflow-hidden rounded-lg border ${t?"border-gray-700":"border-gray-200"}`,children:[e.jsx(le,{src:i.modifiedImageUrl,alt:"修改后的图片",className:"w-full h-auto cursor-pointer transition-transform hover:scale-105",onClick:Q,priority:!0,fit:"contain"}),i.differences.map(c=>p.has(c.id)?e.jsx(b.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"absolute border-2 border-green-500 bg-green-500 bg-opacity-20 rounded-lg",style:{left:`${c.position.x-c.position.width/2}%`,top:`${c.position.y-c.position.height/2}%`,width:`${c.position.width}%`,height:`${c.position.height}%`},children:e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.jsx("i",{className:"fas fa-check"})})},c.id):D&&z&&c.id===z.id?e.jsx(b.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"absolute border-2 border-yellow-500 bg-yellow-500 bg-opacity-20 rounded-lg animate-pulse",style:{left:`${c.position.x-c.position.width/2}%`,top:`${c.position.y-c.position.height/2}%`,width:`${c.position.width}%`,height:`${c.position.height}%`},children:e.jsx("div",{className:"absolute -top-2 -right-2 bg-yellow-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.jsx("i",{className:"fas fa-lightbulb"})})},c.id):null)]})]})]})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&h&&!W&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:h.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:Z(T||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"找到差异"}),e.jsxs("p",{className:"text-xl font-bold",children:[i.differences.length," / ",i.differences.length]})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:J,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:F,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class et{constructor(){q(this,"events",[]),q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextEventId",1),q(this,"nextLevelId",1),this.initEvents(),this.initLevels()}initEvents(){this.events=[{id:`event-${this.nextEventId++}`,title:"天津开埠",year:1860,description:"天津成为中国北方最早开放的通商口岸之一，设立了英、法、美等九国租界，对天津的经济、文化产生了深远影响。",category:"天津历史",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20treaty%20port%20in%201860"},{id:`event-${this.nextEventId++}`,title:"天津卫设立",year:1404,description:'明成祖朱棣下令设立天津卫，意为"天子经过的渡口"，天津正式建城。',category:"天津历史",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20wei%20establishment%20in%201404"},{id:`event-${this.nextEventId++}`,title:"天津大学成立",year:1895,description:"天津大学前身北洋大学成立，是中国第一所现代大学。",category:"天津教育",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20University%20founded%20in%201895"},{id:`event-${this.nextEventId++}`,title:"杨柳青年画兴起",year:1726,description:"杨柳青年画在天津杨柳青镇兴起，成为中国著名的民间木版年画之一。",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Yangliuqing%20New%20Year%20paintings"},{id:`event-${this.nextEventId++}`,title:"泥人张彩塑诞生",year:1844,description:"天津泥人张彩塑艺术由张明山创立，成为中国著名的民间泥塑艺术。",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Niren%20Zhang%20clay%20sculptures"},{id:`event-${this.nextEventId++}`,title:"四大发明完成",year:1300,description:"中国古代四大发明（造纸术、印刷术、火药、指南针）在宋元时期基本完成，对世界文明发展产生了深远影响。",category:"中国科技",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Four%20Great%20Inventions%20of%20ancient%20China"},{id:`event-${this.nextEventId++}`,title:"孔子诞生",year:-551,description:"儒家学派创始人孔子诞生，其思想对中国乃至东亚文化产生了深远影响。",category:"中国哲学",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Confucius%20birth"},{id:`event-${this.nextEventId++}`,title:"京剧形成",year:1790,description:"京剧在乾隆年间形成，融合了徽剧、汉剧等多种戏曲元素，成为中国的国粹。",category:"中国传统艺术",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Beijing%20Opera%20formation"},{id:`event-${this.nextEventId++}`,title:"敦煌莫高窟开凿",year:366,description:"敦煌莫高窟开始开凿，历经多个朝代的修建，成为世界上现存规模最大、内容最丰富的佛教艺术地。",category:"中国佛教艺术",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Dunhuang%20Mogao%20Caves"},{id:`event-${this.nextEventId++}`,title:"《红楼梦》成书",year:1791,description:"中国古典四大名著之一《红楼梦》正式出版，成为中国文学史上的巅峰之作。",category:"中国文学",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Dream%20of%20the%20Red%20Chamber"},{id:`event-${this.nextEventId++}`,title:"兵马俑发现",year:1974,description:'秦始皇兵马俑在陕西西安被发现，被誉为"世界第八大奇迹"。',category:"中国考古",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Terracotta%20Army%20discovery"},{id:`event-${this.nextEventId++}`,title:"指南针应用于航海",year:1100,description:"指南针开始广泛应用于航海，促进了中国古代航海事业的发展和海上丝绸之路的繁荣。",category:"中国科技",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Compass%20used%20in%20navigation"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化时间轴",description:"了解天津历史上的重要文化事件，按照时间顺序排列",events:this.events.slice(0,5),difficulty:"easy",reward:"解锁天津文化时间轴素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20timeline%20game"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化时间轴",description:"了解中国历史上的重要文化事件，按照时间顺序排列",events:this.events.slice(5,10),difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统文化时间轴素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20timeline%20game"},{id:`level-${this.nextLevelId++}`,name:"文化事件大挑战",description:"挑战更复杂的文化事件时间排序，涵盖天津和中国传统文化",events:this.events,difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁高级文化时间轴素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Cultural%20events%20timeline%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getEvents(){return[...this.events]}getEventById(s){return this.events.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),a}checkTimelineOrder(s,t){for(let a=0;a<s.length;a++)if(s[a].id!==t[a].id)return!1;return!0}calculateLevelScore(s,t,a){if(!s)return 0;const r=100,n={easy:.3,medium:.5,hard:.8}[a]||.5,x=Math.max(0,30-t)*n,w={easy:1,medium:1.2,hard:1.5}[a]||1;return Math.round((r+x)*w)}completeLevel(s,t,a,r){const n=this.getGameProgress(s),x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const he=new et,tt=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState([]),[h,$]=l.useState([]),[u,_]=l.useState(null),[T,I]=l.useState(null),[W,L]=l.useState(null),[M,H]=l.useState(!0),[D,P]=l.useState(0),[z,O]=l.useState(!1),[R,A]=l.useState(null);l.useEffect(()=>{if(g){H(!0);try{const m=he.getLevels();if(w(m),a){const E=he.getGameProgress(a.id);_(E)}}catch(m){console.error("加载游戏数据失败:",m)}finally{H(!1)}}},[g,a]),l.useEffect(()=>{if(i){const m=[...i.events].sort(()=>Math.random()-.5);S(m),$([]),n("playing"),I(new Date),L(null),P(0),O(!1),A(null)}},[i]),l.useEffect(()=>{let m;return T&&r==="playing"&&(m=setInterval(()=>{const E=Math.round((new Date().getTime()-T.getTime())/1e3);P(E)},1e3)),()=>clearInterval(m)},[T,r]);const Q=l.useCallback(m=>{if(!a){k.error("请先登录！");return}he.isLevelUnlocked(a.id,m.id)?j(m):k.error("该关卡尚未解锁！")},[a]),X=l.useCallback((m,E)=>{A(E),"dataTransfer"in m&&(m.dataTransfer.effectAllowed="move")},[]),te=l.useCallback(()=>{A(null)},[]),F=l.useCallback(m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},[]),J=l.useCallback((m,E)=>{if(m.preventDefault(),!R)return;const V=p.filter(C=>C.id!==R.id),o=[...h];o.splice(E,0,R),S(V),$(o),A(null),V.length===0&&d()},[R,p,h]),Z=l.useCallback(m=>{if(m.preventDefault(),!R)return;const E=p.filter(o=>o.id!==R.id),V=[...h,R];S(E),$(V),A(null),E.length===0&&d()},[R,p,h]),c=l.useCallback(m=>{const E=h.filter(o=>o.id!==m.id),V=[...p,m];$(E),S(V)},[h,p]),d=l.useCallback(()=>{if(!i)return;const m=[...i.events].sort((E,V)=>E.year-V.year);he.checkTimelineOrder(h,m)?U():k.error("时间顺序不正确，请重新排列！")},[i,h]),N=l.useCallback(()=>{if(!(!a||!u||!i))if(he.useHint(a.id)){const m=[...i.events].sort((V,o)=>V.year-o.year)[h.length];if(m){const V=p.filter(C=>C.id!==m.id),o=[...h,m];S(V),$(o),k.success(`提示：下一个事件是「${m.title}」`)}const E=he.getGameProgress(a.id);_(E)}else k.error("提示已用完")},[a,u,i,p,h]),U=l.useCallback(()=>{if(!a||!i)return;const m=T?Math.round((new Date().getTime()-T.getTime())/1e3):0;L(m);const E=he.calculateLevelScore(!0,m,i.difficulty),V=he.completeLevel(a.id,i.id,E,m);_(V),n("completed"),k.success(`关卡完成！得分：${E}`)},[a,i,T]),ee=l.useCallback(()=>{n("menu"),j(null),S([]),$([]),I(null),L(null),P(0),O(!1),A(null)},[]),y=l.useCallback(()=>{if(!i)return;const m=[...i.events].sort(()=>Math.random()-.5);S(m),$([]),n("playing"),I(new Date),L(null),P(0),O(!1),A(null)},[i]),B=l.useCallback(m=>{if(!m)return"00:00";const E=Math.floor(m/60),V=m%60;return`${E.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:m=>m.target===m.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化时间轴"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[M&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!M&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化时间轴"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"将文化事件按照时间顺序排列，了解天津地方文化和中国传统文化的发展脉络"})]}),u&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:u.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:u.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(m=>{const E=(u==null?void 0:u.completedLevels.includes(m.id))||!1,V=!a||he.isLevelUnlocked(a.id,m.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${V?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:V?{y:-4}:{},onClick:()=>V&&Q(m),children:[m.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:m.imageUrl,alt:m.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),E&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!V&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:m.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:m.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:m.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[m.events.length," 个事件"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:m.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[m.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",B(m.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",m.reward]})]})]},m.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&!M&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ee,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:N,disabled:!u||u.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(u==null?void 0:u.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已排序事件"}),e.jsxs("span",{className:"font-medium",children:[h.length," / ",i.events.length]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:B(D)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余事件"}),e.jsx("span",{className:"font-medium",children:i.events.length-h.length})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium mb-3",children:"待排序事件"}),e.jsx("div",{className:`p-4 rounded-lg border ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} min-h-[300px]`,children:p.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-400":"text-gray-500"}`,children:"所有事件已排序完成！"}):e.jsx("div",{className:"space-y-3",children:p.map(m=>e.jsxs(b.div,{draggable:!0,onDragStart:E=>X(E,m),onDragEnd:te,className:`p-3 rounded-lg cursor-move ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-50 hover:bg-gray-100"} border ${t?"border-gray-600":"border-gray-200"} transition-all shadow-sm hover:shadow-md`,whileHover:{scale:1.02},whileDrag:{opacity:.7},children:[e.jsx("h5",{className:"font-medium",children:m.title}),e.jsx("p",{className:`text-sm mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:m.description})]},m.id))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium mb-3",children:"已排序事件"}),e.jsx("div",{className:`p-4 rounded-lg border ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} min-h-[300px]`,onDragOver:F,onDrop:Z,children:h.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-400":"text-gray-500"}`,children:"将事件从左侧拖拽到这里进行排序"}):e.jsx("div",{className:"space-y-3",children:h.map((m,E)=>e.jsxs("div",{className:`p-3 rounded-lg ${t?"bg-blue-900 bg-opacity-50":"bg-blue-50"} border ${t?"border-blue-700":"border-blue-200"} relative`,onDragOver:F,onDrop:V=>J(V,E),children:[e.jsx("button",{onClick:()=>c(m),className:`absolute top-2 right-2 p-1 rounded-full ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white text-xs transition-colors`,"aria-label":"移除",children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${t?"bg-blue-600":"bg-blue-500"} rounded-l-lg`}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:`inline-block px-2 py-0.5 rounded-full text-xs font-medium mb-1 ${t?"bg-blue-700 text-blue-200":"bg-blue-100 text-blue-800"}`,children:m.year>0?`${m.year}年`:`${Math.abs(m.year)} BCE`}),e.jsx("h5",{className:"font-medium",children:m.title}),e.jsx("p",{className:`text-sm mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:m.description})]})]},m.id))})})]})]}),p.length===0&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:d,className:`px-6 py-3 rounded-lg text-lg font-medium transition-all ${t?"bg-green-600 hover:bg-green-700":"bg-green-500 hover:bg-green-600"} text-white shadow-md hover:shadow-lg`,children:"检查排序顺序"})})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&u&&!M&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:B(W||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"事件数量"}),e.jsx("p",{className:"text-xl font-bold",children:i.events.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:y,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:ee,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class st{constructor(){q(this,"pairs",[]),q(this,"levels",[]),q(this,"gameProgress",new Map),q(this,"nextItemId",1),q(this,"nextPairId",1),q(this,"nextLevelId",1),this.initPairs(),this.initLevels()}initPairs(){const s=[{id:`item-${this.nextItemId++}`,text:"狗不理包子",category:"天津美食",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Goubuli%20baozi%20Tianjin%20food"},{id:`item-${this.nextItemId++}`,text:"天津传统名吃，以皮薄馅大、味道鲜美著称",category:"天津美食",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"杨柳青年画",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Yangliuqing%20New%20Year%20paintings"},{id:`item-${this.nextItemId++}`,text:"天津传统木版年画，以色彩鲜艳、内容丰富著称",category:"天津民间艺术",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"泥人张彩塑",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Niren%20Zhang%20clay%20sculptures"},{id:`item-${this.nextItemId++}`,text:"天津传统泥塑艺术，以造型生动、工艺精湛著称",category:"天津民间艺术",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"天津之眼",category:"天津地标",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20Eye%20ferris%20wheel"},{id:`item-${this.nextItemId++}`,text:"天津标志性建筑，世界上唯一建在桥上的摩天轮",category:"天津地标",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"春节",category:"传统节日",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Chinese%20Spring%20Festival%20celebration"},{id:`item-${this.nextItemId++}`,text:'中国最重要的传统节日，俗称"过年"',category:"传统节日",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"孔子",category:"历史人物",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Confucius%20ancient%20Chinese%20philosopher"},{id:`item-${this.nextItemId++}`,text:"儒家学派创始人，中国古代伟大的思想家和教育家",category:"历史人物",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"造纸术",category:"中国科技",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Papermaking%20ancient%20Chinese%20invention"},{id:`item-${this.nextItemId++}`,text:"中国古代四大发明之一，促进了文化传播",category:"中国科技",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"京剧",category:"传统艺术",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Beijing%20Opera%20performance"},{id:`item-${this.nextItemId++}`,text:"中国国粹，融合了唱、念、做、打等多种艺术形式",category:"传统艺术",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"中秋节",category:"传统节日",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Mid-Autumn%20Festival%20with%20mooncakes"},{id:`item-${this.nextItemId++}`,text:"中国传统节日，赏月、吃月饼是主要习俗",category:"传统节日",culturalTheme:"中国传统文化"}];this.pairs=[{id:`pair-${this.nextPairId++}`,item1:s[0],item2:s[1],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[2],item2:s[3],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[4],item2:s[5],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[6],item2:s[7],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[8],item2:s[9],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[10],item2:s[11],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[12],item2:s[13],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[14],item2:s[15],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[16],item2:s[17],relationship:"是"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化配对",description:"了解天津文化元素及其特点，将相关元素进行配对",pairs:this.pairs.slice(0,4),difficulty:"easy",reward:"解锁天津文化配对素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20pair%20matching%20game"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化配对",description:"了解中国传统文化元素及其特点，将相关元素进行配对",pairs:this.pairs.slice(4,9),difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统文化配对素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20pair%20matching%20game"},{id:`level-${this.nextLevelId++}`,name:"文化配对大挑战",description:"挑战更复杂的文化元素配对，涵盖天津和中国传统文化",pairs:this.pairs,difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁高级文化配对素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Cultural%20pair%20matching%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getPairs(){return[...this.pairs]}getPairById(s){return this.pairs.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const a={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,a),a}checkPairMatch(s,t,a){return a.some(r=>r.item1.id===s&&r.item2.id===t||r.item1.id===t&&r.item2.id===s)}calculateLevelScore(s,t,a,r){const n=s/t,x=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[r]||.5,i=t*30,j=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[r]||1;return Math.round((x+j)*p)}completeLevel(s,t,a,r){const n=this.getGameProgress(s),x={...n.bestTimes};(!x[t]||r<x[t])&&(x[t]=r);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:x,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const r=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?r.completedLevels.length>=n.value:n.type==="score"?r.totalScore>=n.value:!1}}const ue=new st,at=({isOpen:g,onClose:s})=>{const{isDark:t}=ce(),{user:a}=l.useContext(pe),[r,n]=l.useState("menu"),[x,w]=l.useState([]),[i,j]=l.useState(null),[p,S]=l.useState([]),[h,$]=l.useState([]),[u,_]=l.useState(new Set),[T,I]=l.useState(null),[W,L]=l.useState(null),[M,H]=l.useState(null),[D,P]=l.useState(!0),[z,O]=l.useState(0),[R,A]=l.useState(!1);l.useEffect(()=>{if(g){P(!0);try{const d=ue.getLevels();if(w(d),a){const N=ue.getGameProgress(a.id);I(N)}}catch(d){console.error("加载游戏数据失败:",d)}finally{P(!1)}}},[g,a]),l.useEffect(()=>{if(i){const d=i.pairs.flatMap(N=>[N.item1,N.item2]).sort(()=>Math.random()-.5);S(d),$([]),_(new Set),n("playing"),L(new Date),H(null),O(0),A(!1)}},[i]),l.useEffect(()=>{let d;return W&&r==="playing"&&(d=setInterval(()=>{const N=Math.round((new Date().getTime()-W.getTime())/1e3);O(N)},1e3)),()=>clearInterval(d)},[W,r]);const Q=l.useCallback(d=>{if(!a){k.error("请先登录！");return}ue.isLevelUnlocked(a.id,d.id)?j(d):k.error("该关卡尚未解锁！")},[a]),X=l.useCallback(d=>{if(!(r!=="playing"||!i)&&!u.has(d))if(h.length===2)$([d]);else if(h.includes(d))$([]);else{const N=[...h,d];if($(N),N.length===2){const[U,ee]=N;ue.checkPairMatch(U,ee,i.pairs)?(_(y=>{const B=new Set(y);return B.add(U),B.add(ee),B}),$([]),k.success("配对成功！"),u.size+2===p.length&&F()):setTimeout(()=>{$([]),k.error("配对错误，请重新尝试！")},500)}}},[r,i,h,u,p.length]),te=l.useCallback(()=>{if(!(!a||!T||!i))if(ue.useHint(a.id)){const d=i.pairs.filter(U=>!u.has(U.item1.id)&&!u.has(U.item2.id));if(d.length>0){const U=d[0];A(!0),setTimeout(()=>{A(!1)},2e3),k.success(`提示：「${U.item1.text}」和「${U.item2.text}」是一对`)}const N=ue.getGameProgress(a.id);I(N)}else k.error("提示已用完")},[a,T,i,u]),F=l.useCallback(()=>{if(!a||!i)return;const d=W?Math.round((new Date().getTime()-W.getTime())/1e3):0;H(d);const N=ue.calculateLevelScore(u.size/2,i.pairs.length,d,i.difficulty),U=ue.completeLevel(a.id,i.id,N,d);I(U),n("completed"),k.success(`关卡完成！得分：${N}`)},[a,i,u.size,W]),J=l.useCallback(()=>{n("menu"),j(null),S([]),$([]),_(new Set),L(null),H(null),O(0),A(!1)},[]),Z=l.useCallback(()=>{if(!i)return;const d=i.pairs.flatMap(N=>[N.item1,N.item2]).sort(()=>Math.random()-.5);S(d),$([]),_(new Set),n("playing"),L(new Date),H(null),O(0),A(!1)},[i]),c=l.useCallback(d=>{if(!d)return"00:00";const N=Math.floor(d/60),U=d%60;return`${N.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}`},[]);return g?e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:d=>d.target===d.currentTarget&&s(),children:e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化配对游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[D&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(K,{mode:"wait",children:r==="menu"&&!D&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化配对游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"将相关的文化元素进行配对，了解天津地方文化和中国传统文化的丰富内涵"})]}),T&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:T.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:T.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:T.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:x.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(d=>{const N=(T==null?void 0:T.completedLevels.includes(d.id))||!1,U=!a||ue.isLevelUnlocked(a.id,d.id);return e.jsxs(b.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${U?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:U?{y:-4}:{},onClick:()=>U&&Q(d),children:[d.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(le,{src:d.imageUrl,alt:d.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),N&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!U&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:d.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:d.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:d.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[d.pairs.length," 对配对"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:d.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[d.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",c(d.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",d.reward]})]})]},d.id)})})]},"menu")}),e.jsx(K,{mode:"wait",children:r==="playing"&&i&&!D&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:J,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:te,disabled:!T||T.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(T==null?void 0:T.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已匹配对数"}),e.jsxs("span",{className:"font-medium",children:[u.size/2," / ",i.pairs.length]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:c(z)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余配对"}),e.jsx("span",{className:"font-medium",children:i.pairs.length-u.size/2})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:p.map(d=>{const N=h.includes(d.id),U=u.has(d.id),ee=R&&i.pairs.some(y=>(y.item1.id===d.id||y.item2.id===d.id)&&!u.has(d.id));return e.jsxs(b.div,{className:`p-4 rounded-lg cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${N?t?"border-blue-500 bg-blue-900 bg-opacity-30":"border-blue-500 bg-blue-50":U?t?"border-green-500 bg-green-900 bg-opacity-30":"border-green-500 bg-green-50":ee?t?"border-yellow-500 bg-yellow-900 bg-opacity-30":"border-yellow-500 bg-yellow-50":t?"bg-gray-700 hover:bg-gray-600":"bg-white hover:bg-gray-50"} shadow-sm hover:shadow-md`,whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>X(d.id),children:[d.imageUrl&&e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:e.jsx(le,{src:d.imageUrl,alt:d.text,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"})}),e.jsx("h5",{className:"font-medium",children:d.text}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:d.category})]},d.id)})})]},"playing")}),e.jsx(K,{mode:"wait",children:r==="completed"&&i&&T&&!D&&e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:T.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:c(M||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"配对对数"}),e.jsxs("p",{className:"text-xl font-bold",children:[i.pairs.length," / ",i.pairs.length]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:Z,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:J,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null},rt=()=>{const{isDark:g}=ce(),[s,t]=l.useState(!1),[a,r]=l.useState(!1),[n,x]=l.useState(!1),[w,i]=l.useState(!1),[j,p]=l.useState(!1),[S,h]=l.useState(!1),[$,u]=l.useState(!1),[_,T]=l.useState(!1),[I,W]=l.useState(!1),[L,M]=l.useState(!1);return e.jsx("div",{className:`min-h-screen ${g?"bg-gray-900 text-white":"bg-white text-gray-900"}`,children:s?e.jsx(Le,{isOpen:s,onClose:()=>t(!1)}):a?e.jsx(Ue,{isOpen:a,onClose:()=>r(!1)}):n?e.jsx(Ce,{isOpen:n,onClose:()=>x(!1)}):w?e.jsx(Re,{isOpen:w,onClose:()=>i(!1)}):j?e.jsx(Fe,{isOpen:j,onClose:()=>p(!1)}):S?e.jsx(Ye,{isOpen:S,onClose:()=>h(!1)}):$?e.jsx(Xe,{isOpen:$,onClose:()=>u(!1)}):_?e.jsx(Ze,{isOpen:_,onClose:()=>T(!1)}):I?e.jsx(tt,{isOpen:I,onClose:()=>W(!1)}):L?e.jsx(at,{isOpen:L,onClose:()=>M(!1)}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(Se,{title:"文化知识游戏",subtitle:"通过游戏学习天津地方文化和中国传统文化",theme:"indigo",stats:[{label:"游戏类型",value:"多样化"},{label:"难度级别",value:"分关卡"},{label:"学习方式",value:"互动式"},{label:"挑战模式",value:"计时赛"}],pattern:!0,size:"lg"}),e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},className:"mt-8 grid md:grid-cols-2 gap-8 mb-12",children:[e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Cultural%20quiz%20game%20interface%20with%20traditional%20Chinese%20elements",alt:"文化知识挑战",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化知识挑战"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"测试你对天津地方文化和中国传统文化的了解，包含多种题型和难度级别。"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种题型：单选题、多选题、判断题"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"关卡制：包含3个不同难度的关卡"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的答题时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示系统：提供提示帮助你解题"})]})]}),e.jsxs("button",{onClick:()=>t(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-question-circle mr-2"}),"开始挑战"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Memory%20card%20game%20with%20Chinese%20cultural%20elements%20flip%20cards",alt:"文化记忆游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化记忆游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"翻牌匹配相同的文化元素，挑战你的记忆力和文化知识，包含多种难度级别。"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种难度：4x4、6x6、8x8网格"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"精美的卡片设计：包含文化元素图片和介绍"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"进度保存：记录你的游戏成就"})]})]}),e.jsxs("button",{onClick:()=>r(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-purple-600 hover:bg-purple-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-gamepad mr-2"}),"开始游戏"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Matching%20game%20with%20Chinese%20cultural%20elements%20cards",alt:"文化元素连连看",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化元素连连看"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"通过匹配相同的文化元素卡片，了解中国传统文化和天津地方特色，赢取丰厚奖励！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种关卡：从简单到困难，逐步挑战"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的文化元素：包含天津地方特色和中国传统文化"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间，挑战最佳成绩"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示系统：遇到困难时可使用提示功能"})]})]}),e.jsxs("button",{onClick:()=>x(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-gamepad mr-2"}),"开始游戏"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Puzzle%20game%20with%20Chinese%20cultural%20elements%20in%20Tianjin",alt:"文化拼图游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化拼图游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"拼合文化图片碎片，了解天津地方文化和中国传统文化，挑战你的观察力和动手能力！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种难度：4x4、5x5、6x6 不同规格的拼图"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的文化图片：包含天津地标、民俗文化和非遗技艺"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间和移动次数"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示功能：遇到困难时可使用提示和查看答案"})]})]}),e.jsxs("button",{onClick:()=>i(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-purple-600 hover:bg-purple-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-gamepad mr-2"}),"开始游戏"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Sorting%20game%20with%20Chinese%20cultural%20elements%20timeline",alt:"文化元素排序游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化元素排序游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"按照时间顺序或逻辑顺序排列文化元素，了解天津地方文化和中国传统文化的发展脉络！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种排序类型：时间顺序、逻辑顺序"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"拖拽排序：支持直观的拖拽操作"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供文化元素的详细介绍"})]})]}),e.jsxs("button",{onClick:()=>p(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-green-600 hover:bg-green-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-sort mr-2"}),"开始排序"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Riddle%20game%20with%20Chinese%20cultural%20elements%20lanterns",alt:"文化猜谜游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化猜谜游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"根据提示猜文化元素、成语或历史人物，了解天津地方文化和中国传统文化的丰富内涵！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种猜谜类型：文化元素、成语、历史人物"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"递进式提示：提供多级提示帮助解题"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供谜底的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>h(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-orange-600 hover:bg-orange-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),"开始猜谜"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Word%20chain%20game%20with%20Chinese%20cultural%20elements",alt:"文化词汇接龙游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化词汇接龙游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"从给定的文化词汇开始，按照规则接龙，挑战你的词汇量和文化知识！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的文化词汇：涵盖天津地方文化和中国传统文化"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"拖拽式操作：直观的拖拽排序玩法"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示功能：遇到困难时可使用提示"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供词汇的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-cyan-600 hover:bg-cyan-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-link mr-2"}),"开始接龙"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Spot%20the%20difference%20game%20with%20Chinese%20cultural%20images",alt:"文化图片找茬游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化图片找茬游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"对比两张文化主题图片，找出所有不同之处，考验你的观察力和文化敏感度！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"精美的文化图片：包含天津地方文化和中国传统文化元素"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"自动识别差异：点击图片即可标记差异"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供差异处的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>T(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-pink-600 hover:bg-pink-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"开始找茬"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Timeline%20game%20with%20Chinese%20historical%20events",alt:"文化时间轴游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化时间轴游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"将历史文化事件按照时间顺序排列，了解天津和中国传统文化的发展脉络！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的历史事件：涵盖不同时期的文化发展"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"拖拽式操作：直观的时间轴排序玩法"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供事件的历史背景介绍"})]})]}),e.jsxs("button",{onClick:()=>W(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-amber-600 hover:bg-amber-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-history mr-2"}),"开始排序"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Pair%20matching%20game%20with%20Chinese%20cultural%20elements",alt:"文化配对游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化配对游戏"}),e.jsx("p",{className:`mb-4 ${g?"text-gray-300":"text-gray-700"}`,children:"翻转卡片，找到匹配的文化元素对，挑战你的记忆力和文化知识！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"精美的卡片设计：包含文化元素图片和介绍"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种难度：不同数量的卡片组合"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供配对元素的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>M(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-puzzle-piece mr-2"}),"开始配对"]})]})]}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:`p-6 rounded-xl shadow-lg ${g?"bg-gray-800":"bg-white"} mb-12`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"游戏特色"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 text-red-600 flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-book-open text-2xl"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"文化学习"}),e.jsx("p",{className:g?"text-gray-300":"text-gray-700",children:"通过游戏了解天津地方文化和中国传统文化的丰富内涵"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-user-friends text-2xl"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"互动体验"}),e.jsx("p",{className:g?"text-gray-300":"text-gray-700",children:"丰富的互动设计，让学习变得更加有趣和生动"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 text-green-600 flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-trophy text-2xl"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"挑战成就"}),e.jsx("p",{className:g?"text-gray-300":"text-gray-700",children:"完成关卡获得奖励，解锁新的游戏内容和成就"})]})]})]})]})})};export{rt as default};
